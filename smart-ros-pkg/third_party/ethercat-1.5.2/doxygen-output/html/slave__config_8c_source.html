<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>IgH EtherCAT Master: slave_config.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">IgH EtherCAT Master
   &#160;<span id="projectnumber">1.5.2</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('slave__config_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">slave_config.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="slave__config_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> *  $Id: slave_config.c,v ec403cf308eb 2013/02/12 14:46:43 fp $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Copyright (C) 2006-2012  Florian Pose, Ingenieurgemeinschaft IgH</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> *  This file is part of the IgH EtherCAT Master.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *  The IgH EtherCAT Master is free software; you can redistribute it and/or</span>
<a name="l00010"></a>00010 <span class="comment"> *  modify it under the terms of the GNU General Public License version 2, as</span>
<a name="l00011"></a>00011 <span class="comment"> *  published by the Free Software Foundation.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *  The IgH EtherCAT Master is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<a name="l00016"></a>00016 <span class="comment"> *  Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> *  You should have received a copy of the GNU General Public License along</span>
<a name="l00019"></a>00019 <span class="comment"> *  with the IgH EtherCAT Master; if not, write to the Free Software</span>
<a name="l00020"></a>00020 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> *  ---</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> *  The license mentioned above concerns the source code only. Using the</span>
<a name="l00025"></a>00025 <span class="comment"> *  EtherCAT technology and brand is only permitted in compliance with the</span>
<a name="l00026"></a>00026 <span class="comment"> *  industrial property and similar rights of Beckhoff Automation GmbH.</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> *  vim: expandtab</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> *****************************************************************************/</span>
<a name="l00031"></a>00031 
<a name="l00037"></a>00037 <span class="comment">/*****************************************************************************/</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;linux/module.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;linux/slab.h&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html" title="Global definitions and macros.">globals.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="master_8h.html" title="EtherCAT master structure.">master.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="voe__handler_8h.html" title="Vendor specific over EtherCAT protocol handler.">voe_handler.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="slave__config_8h.html" title="EtherCAT slave configuration structure.">slave_config.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">/*****************************************************************************/</span>
<a name="l00049"></a>00049 
<a name="l00055"></a><a class="code" href="slave__config_8h.html#a1f74fc37c81571a4ce339c0fb07d6223">00055</a> <span class="keywordtype">void</span> <a class="code" href="slave__config_8c.html#a89e3c5573a34a9e495cf6b467e223af4" title="Slave configuration constructor.">ec_slave_config_init</a>(
<a name="l00056"></a>00056         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, 
<a name="l00057"></a>00057         <a class="code" href="structec__master.html" title="EtherCAT master.">ec_master_t</a> *master, 
<a name="l00058"></a>00058         uint16_t alias, 
<a name="l00059"></a>00059         uint16_t position, 
<a name="l00060"></a>00060         uint32_t vendor_id, 
<a name="l00061"></a>00061         uint32_t product_code 
<a name="l00062"></a>00062         )
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a> = master;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     sc-&gt;<a class="code" href="structec__slave__config.html#a62dbce2ad4cf9367261c293534d0730c" title="Slave alias.">alias</a> = alias;
<a name="l00069"></a>00069     sc-&gt;<a class="code" href="structec__slave__config.html#adf5176b65d59852f91125066b6bf3f07" title="Index after alias.">position</a> = position;
<a name="l00070"></a>00070     sc-&gt;<a class="code" href="structec__slave__config.html#ad561239255f4392e34fb12e0327063e0" title="Slave vendor ID.">vendor_id</a> = vendor_id;
<a name="l00071"></a>00071     sc-&gt;<a class="code" href="structec__slave__config.html#a11dfa0af49e66d7b44f2b78d122e1040" title="Slave product code.">product_code</a> = product_code;
<a name="l00072"></a>00072     sc-&gt;<a class="code" href="structec__slave__config.html#aaa1db6b3136fa60412cbf8d1302c48e9" title="Watchdog divider as a number of 40ns intervals (see spec.">watchdog_divider</a> = 0; <span class="comment">// use default</span>
<a name="l00073"></a>00073     sc-&gt;<a class="code" href="structec__slave__config.html#a51e0bd197191abd7a46fd3206575eccb" title="Process data watchdog intervals (see spec.">watchdog_intervals</a> = 0; <span class="comment">// use default</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075     sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a> = NULL;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>; i++)
<a name="l00078"></a>00078         <a class="code" href="sync__config_8c.html#ab94e78860fab0b248f512d564223a32c" title="Constructor.">ec_sync_config_init</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[i]);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     sc-&gt;<a class="code" href="structec__slave__config.html#ab34b5531b56f3bb35ea0647f3aa8345a" title="Number of FMMUs used.">used_fmmus</a> = 0;
<a name="l00081"></a>00081     sc-&gt;<a class="code" href="structec__slave__config.html#a444000aa859f4830053b65518fc65233" title="Vendor-specific AssignActivate word.">dc_assign_activate</a> = 0x0000;
<a name="l00082"></a>00082     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[0].<a class="code" href="structec__sync__signal__t.html#a584e9c4963c35777cfc06838793e20e0" title="Cycle time [ns].">cycle_time</a> = 0U;
<a name="l00083"></a>00083     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[1].<a class="code" href="structec__sync__signal__t.html#a584e9c4963c35777cfc06838793e20e0" title="Cycle time [ns].">cycle_time</a> = 0;
<a name="l00084"></a>00084     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[0].<a class="code" href="structec__sync__signal__t.html#a75c1a27b0421473e05bf737fd0d38368" title="Shift time [ns].">shift_time</a> = 0U;
<a name="l00085"></a>00085     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[1].<a class="code" href="structec__sync__signal__t.html#a75c1a27b0421473e05bf737fd0d38368" title="Shift time [ns].">shift_time</a> = 0;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     INIT_LIST_HEAD(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#aa980b60539d3818999fe9ba116851e1c" title="List of SDO configurations.">sdo_configs</a>);
<a name="l00088"></a>00088     INIT_LIST_HEAD(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a51461cce3b38ac55be3e046c5e93a932" title="List of SDO requests.">sdo_requests</a>);
<a name="l00089"></a>00089     INIT_LIST_HEAD(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a391b64268ec07ce78e7aa50c9641e436" title="List of register requests.">reg_requests</a>);
<a name="l00090"></a>00090     INIT_LIST_HEAD(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#afab81a75365c94fde03e15446fe7cc9e" title="List of VoE handlers.">voe_handlers</a>);
<a name="l00091"></a>00091     INIT_LIST_HEAD(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a9bfab1eba98284fcaa21079ea1700188" title="List of SoE configurations.">soe_configs</a>);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <a class="code" href="coe__emerg__ring_8c.html#a47aeba0336dfc752903be4af5c7413ad" title="Emergency ring buffer constructor.">ec_coe_emerg_ring_init</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a8a43523dca6d68508d858813f3d497a9" title="CoE emergency ring buffer.">emerg_ring</a>, sc);
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">/*****************************************************************************/</span>
<a name="l00097"></a>00097 
<a name="l00102"></a><a class="code" href="slave__config_8h.html#a5eb139fdc11dfc4c540fc43259eaa773">00102</a> <span class="keywordtype">void</span> <a class="code" href="slave__config_8c.html#a76d9ec03885e1734c4ca7fd27490b193" title="Slave configuration destructor.">ec_slave_config_clear</a>(
<a name="l00103"></a>00103         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc 
<a name="l00104"></a>00104         )
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00107"></a>00107     <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *req, *next_req;
<a name="l00108"></a>00108     <a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *voe, *next_voe;
<a name="l00109"></a>00109     <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *reg, *next_reg;
<a name="l00110"></a>00110     <a class="code" href="structec__soe__request__t.html" title="Sercos-over-EtherCAT request.">ec_soe_request_t</a> *soe, *next_soe;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <a class="code" href="slave__config_8c.html#af8f9c0e68dfe4781fa922ca9c4ec7e94" title="Detaches the configuration from a slave object.">ec_slave_config_detach</a>(sc);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="comment">// Free sync managers</span>
<a name="l00115"></a>00115     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>; i++)
<a name="l00116"></a>00116         <a class="code" href="sync__config_8c.html#a58935740adbd4abcc2edb3c30054bc96" title="Destructor.">ec_sync_config_clear</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[i]);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="comment">// free all SDO configurations</span>
<a name="l00119"></a>00119     list_for_each_entry_safe(req, next_req, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#aa980b60539d3818999fe9ba116851e1c" title="List of SDO configurations.">sdo_configs</a>, list) {
<a name="l00120"></a>00120         list_del(&amp;req-&gt;<a class="code" href="structec__sdo__request.html#a80c68878d98d613513a0b985be43198e" title="List item.">list</a>);
<a name="l00121"></a>00121         <a class="code" href="sdo__request_8c.html#af3a555948ca6b916238e6c696d676645" title="SDO request destructor.">ec_sdo_request_clear</a>(req);
<a name="l00122"></a>00122         kfree(req);
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="comment">// free all SDO requests</span>
<a name="l00126"></a>00126     list_for_each_entry_safe(req, next_req, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a51461cce3b38ac55be3e046c5e93a932" title="List of SDO requests.">sdo_requests</a>, list) {
<a name="l00127"></a>00127         list_del(&amp;req-&gt;<a class="code" href="structec__sdo__request.html#a80c68878d98d613513a0b985be43198e" title="List item.">list</a>);
<a name="l00128"></a>00128         <a class="code" href="sdo__request_8c.html#af3a555948ca6b916238e6c696d676645" title="SDO request destructor.">ec_sdo_request_clear</a>(req);
<a name="l00129"></a>00129         kfree(req);
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">// free all register requests</span>
<a name="l00133"></a>00133     list_for_each_entry_safe(reg, next_reg, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a391b64268ec07ce78e7aa50c9641e436" title="List of register requests.">reg_requests</a>, list) {
<a name="l00134"></a>00134         list_del(&amp;reg-&gt;<a class="code" href="structec__reg__request.html#a5b7e2c24fe669f62e8d325a3537a1aec" title="List item.">list</a>);
<a name="l00135"></a>00135         <a class="code" href="reg__request_8c.html#ab5a73a3a36f63ee80aeafacdb3c9e6d2" title="Register request destructor.">ec_reg_request_clear</a>(reg);
<a name="l00136"></a>00136         kfree(reg);
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="comment">// free all VoE handlers</span>
<a name="l00140"></a>00140     list_for_each_entry_safe(voe, next_voe, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#afab81a75365c94fde03e15446fe7cc9e" title="List of VoE handlers.">voe_handlers</a>, list) {
<a name="l00141"></a>00141         list_del(&amp;voe-&gt;<a class="code" href="structec__voe__handler.html#ab078e6fbc73c7bb4f7cb465b6c4abfa3" title="List item.">list</a>);
<a name="l00142"></a>00142         <a class="code" href="voe__handler_8c.html#a5177aa3c9bf760a01f2fa069536a1499" title="VoE handler destructor.">ec_voe_handler_clear</a>(voe);
<a name="l00143"></a>00143         kfree(voe);
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="comment">// free all SoE configurations</span>
<a name="l00147"></a>00147     list_for_each_entry_safe(soe, next_soe, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a9bfab1eba98284fcaa21079ea1700188" title="List of SoE configurations.">soe_configs</a>, list) {
<a name="l00148"></a>00148         list_del(&amp;soe-&gt;<a class="code" href="structec__soe__request__t.html#a07cafa8f400f95ced4f6037629c979f6" title="List item.">list</a>);
<a name="l00149"></a>00149         <a class="code" href="soe__request_8c.html#af363b99bdce32c73c89bcec7520b5d01" title="SoE request destructor.">ec_soe_request_clear</a>(soe);
<a name="l00150"></a>00150         kfree(soe);
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <a class="code" href="coe__emerg__ring_8c.html#af7cc151e78f390fe9c3a12b73da6451d" title="Emergency ring buffer destructor.">ec_coe_emerg_ring_clear</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a8a43523dca6d68508d858813f3d497a9" title="CoE emergency ring buffer.">emerg_ring</a>);
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">/*****************************************************************************/</span>
<a name="l00157"></a>00157 
<a name="l00170"></a><a class="code" href="slave__config_8c.html#a6c908bc3c5044575e96e5dc1554c9bc1">00170</a> <span class="keywordtype">int</span> <a class="code" href="slave__config_8c.html#a6c908bc3c5044575e96e5dc1554c9bc1" title="Prepares an FMMU configuration.">ec_slave_config_prepare_fmmu</a>(
<a name="l00171"></a>00171         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, 
<a name="l00172"></a>00172         <a class="code" href="structec__domain.html" title="EtherCAT domain.">ec_domain_t</a> *domain, 
<a name="l00173"></a>00173         uint8_t sync_index, 
<a name="l00174"></a>00174         <a class="code" href="group__ApplicationInterface.html#ga703c4e47384b3601e7605d6d910aaba1" title="Direction type for PDO assignment functions.">ec_direction_t</a> dir 
<a name="l00175"></a>00175         )
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00178"></a>00178     <a class="code" href="structec__fmmu__config__t.html" title="FMMU configuration.">ec_fmmu_config_t</a> *fmmu;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="comment">// FMMU configuration already prepared?</span>
<a name="l00181"></a>00181     <span class="keywordflow">for</span> (i = 0; i &lt; sc-&gt;<a class="code" href="structec__slave__config.html#ab34b5531b56f3bb35ea0647f3aa8345a" title="Number of FMMUs used.">used_fmmus</a>; i++) {
<a name="l00182"></a>00182         fmmu = &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a87548f86b5a467a0d2da312571bac4c0" title="FMMU configurations.">fmmu_configs</a>[i];
<a name="l00183"></a>00183         <span class="keywordflow">if</span> (fmmu-&gt;<a class="code" href="structec__fmmu__config__t.html#a189c237bbb083b9ef1924673026de193" title="Domain.">domain</a> == domain &amp;&amp; fmmu-&gt;<a class="code" href="structec__fmmu__config__t.html#aa77d8e55cd99d08955d2566fc2ab4eec" title="Index of sync manager to use.">sync_index</a> == sync_index)
<a name="l00184"></a>00184             <span class="keywordflow">return</span> fmmu-&gt;<a class="code" href="structec__fmmu__config__t.html#a04092cc6d2d3d1c5a4d1703265e414cc" title="Logical start address.">logical_start_address</a>;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="structec__slave__config.html#ab34b5531b56f3bb35ea0647f3aa8345a" title="Number of FMMUs used.">used_fmmus</a> == <a class="code" href="globals_8h.html#a7ef0b04594f3ae62859391b9307cbb1f" title="Maximum number of FMMUs per slave.">EC_MAX_FMMUS</a>) {
<a name="l00188"></a>00188         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;FMMU limit reached!\n&quot;</span>);
<a name="l00189"></a>00189         <span class="keywordflow">return</span> -EOVERFLOW;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     fmmu = &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a87548f86b5a467a0d2da312571bac4c0" title="FMMU configurations.">fmmu_configs</a>[sc-&gt;<a class="code" href="structec__slave__config.html#ab34b5531b56f3bb35ea0647f3aa8345a" title="Number of FMMUs used.">used_fmmus</a>++];
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00195"></a>00195     <a class="code" href="fmmu__config_8c.html#abb64d16f6f17f6bd506fafefedad65ff" title="FMMU configuration constructor.">ec_fmmu_config_init</a>(fmmu, sc, domain, sync_index, dir);
<a name="l00196"></a>00196     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="keywordflow">return</span> fmmu-&gt;<a class="code" href="structec__fmmu__config__t.html#a04092cc6d2d3d1c5a4d1703265e414cc" title="Logical start address.">logical_start_address</a>;
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="comment">/*****************************************************************************/</span>
<a name="l00202"></a>00202 
<a name="l00208"></a><a class="code" href="slave__config_8h.html#ab03a5b77c51578728a32d17d007364cc">00208</a> <span class="keywordtype">int</span> <a class="code" href="slave__config_8c.html#abb5cb481f42d644f581e52d5c876bfb9" title="Attaches the configuration to the addressed slave object.">ec_slave_config_attach</a>(
<a name="l00209"></a>00209         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc 
<a name="l00210"></a>00210         )
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <a class="code" href="structec__slave.html" title="EtherCAT slave.">ec_slave_t</a> *slave;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>)
<a name="l00215"></a>00215         <span class="keywordflow">return</span> 0; <span class="comment">// already attached</span>
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">if</span> (!(slave = <a class="code" href="master_8c.html#a219b6e4e9e03c176c716a9f77a745c53" title="Finds a slave in the bus, given the alias and position.">ec_master_find_slave</a>(
<a name="l00218"></a>00218                     sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>, sc-&gt;<a class="code" href="structec__slave__config.html#a62dbce2ad4cf9367261c293534d0730c" title="Slave alias.">alias</a>, sc-&gt;<a class="code" href="structec__slave__config.html#adf5176b65d59852f91125066b6bf3f07" title="Index after alias.">position</a>))) {
<a name="l00219"></a>00219         <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Failed to find slave for configuration.\n&quot;</span>);
<a name="l00220"></a>00220         <span class="keywordflow">return</span> -ENOENT;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (slave-&gt;<a class="code" href="structec__slave.html#a35616766fc7afbd4fc0b8a5d5a652bf7" title="Current configuration.">config</a>) {
<a name="l00224"></a>00224         <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Failed to attach configuration. Slave %u&quot;</span>
<a name="l00225"></a>00225                 <span class="stringliteral">&quot; already has a configuration!\n&quot;</span>, slave-&gt;<a class="code" href="structec__slave.html#a337a538c53fb9ac8bcfb951fd445e0a1" title="Ring position.">ring_position</a>);
<a name="l00226"></a>00226         <span class="keywordflow">return</span> -EEXIST;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (
<a name="l00230"></a>00230 #ifdef EC_IDENT_WILDCARDS
<a name="l00231"></a>00231             sc-&gt;<a class="code" href="structec__slave__config.html#ad561239255f4392e34fb12e0327063e0" title="Slave vendor ID.">vendor_id</a> != 0xffffffff &amp;&amp;
<a name="l00232"></a>00232 #endif
<a name="l00233"></a>00233             slave-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#ad185baf2f7711424507c20f6e96b7014" title="Vendor ID.">vendor_id</a> != sc-&gt;<a class="code" href="structec__slave__config.html#ad561239255f4392e34fb12e0327063e0" title="Slave vendor ID.">vendor_id</a>
<a name="l00234"></a>00234        ) {
<a name="l00235"></a>00235         <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Slave %u has no matching vendor ID (0x%08X)&quot;</span>
<a name="l00236"></a>00236                 <span class="stringliteral">&quot; for configuration (0x%08X).\n&quot;</span>,
<a name="l00237"></a>00237                 slave-&gt;<a class="code" href="structec__slave.html#a337a538c53fb9ac8bcfb951fd445e0a1" title="Ring position.">ring_position</a>, slave-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#ad185baf2f7711424507c20f6e96b7014" title="Vendor ID.">vendor_id</a>, sc-&gt;<a class="code" href="structec__slave__config.html#ad561239255f4392e34fb12e0327063e0" title="Slave vendor ID.">vendor_id</a>);
<a name="l00238"></a>00238         <span class="keywordflow">return</span> -EINVAL;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (
<a name="l00242"></a>00242 #ifdef EC_IDENT_WILDCARDS
<a name="l00243"></a>00243             sc-&gt;<a class="code" href="structec__slave__config.html#a11dfa0af49e66d7b44f2b78d122e1040" title="Slave product code.">product_code</a> != 0xffffffff &amp;&amp;
<a name="l00244"></a>00244 #endif
<a name="l00245"></a>00245             slave-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#a69a301c8203300eddd299807a617ad03" title="Vendor-specific product code.">product_code</a> != sc-&gt;<a class="code" href="structec__slave__config.html#a11dfa0af49e66d7b44f2b78d122e1040" title="Slave product code.">product_code</a>
<a name="l00246"></a>00246        ) {
<a name="l00247"></a>00247         <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Slave %u has no matching product code (0x%08X)&quot;</span>
<a name="l00248"></a>00248                 <span class="stringliteral">&quot; for configuration (0x%08X).\n&quot;</span>,
<a name="l00249"></a>00249                 slave-&gt;<a class="code" href="structec__slave.html#a337a538c53fb9ac8bcfb951fd445e0a1" title="Ring position.">ring_position</a>, slave-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#a69a301c8203300eddd299807a617ad03" title="Vendor-specific product code.">product_code</a>,
<a name="l00250"></a>00250                 sc-&gt;<a class="code" href="structec__slave__config.html#a11dfa0af49e66d7b44f2b78d122e1040" title="Slave product code.">product_code</a>);
<a name="l00251"></a>00251         <span class="keywordflow">return</span> -EINVAL;
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="comment">// attach slave</span>
<a name="l00255"></a>00255     slave-&gt;<a class="code" href="structec__slave.html#a35616766fc7afbd4fc0b8a5d5a652bf7" title="Current configuration.">config</a> = sc;
<a name="l00256"></a>00256     sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a> = slave;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Attached slave %u.\n&quot;</span>, slave-&gt;<a class="code" href="structec__slave.html#a337a538c53fb9ac8bcfb951fd445e0a1" title="Ring position.">ring_position</a>);
<a name="l00259"></a>00259     <span class="keywordflow">return</span> 0;
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 <span class="comment">/*****************************************************************************/</span>
<a name="l00263"></a>00263 
<a name="l00266"></a><a class="code" href="slave__config_8h.html#aa39222478a857c6f0edac29d6b22350a">00266</a> <span class="keywordtype">void</span> <a class="code" href="slave__config_8c.html#af8f9c0e68dfe4781fa922ca9c4ec7e94" title="Detaches the configuration from a slave object.">ec_slave_config_detach</a>(
<a name="l00267"></a>00267         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc 
<a name="l00268"></a>00268         )
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>) {
<a name="l00271"></a>00271         <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *reg;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#a35616766fc7afbd4fc0b8a5d5a652bf7" title="Current configuration.">config</a> = NULL;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="comment">// invalidate processing register request</span>
<a name="l00276"></a>00276         list_for_each_entry(reg, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a391b64268ec07ce78e7aa50c9641e436" title="List of register requests.">reg_requests</a>, list) {
<a name="l00277"></a>00277             <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#aecb677b730d579c8eeeaa83a432a74a8" title="Slave state machine.">fsm</a>.<a class="code" href="structec__fsm__slave.html#a337fc81f36562866d9cdc92e78ef4fdc" title="Register request to process.">reg_request</a> == reg) {
<a name="l00278"></a>00278                 sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#aecb677b730d579c8eeeaa83a432a74a8" title="Slave state machine.">fsm</a>.<a class="code" href="structec__fsm__slave.html#a337fc81f36562866d9cdc92e78ef4fdc" title="Register request to process.">reg_request</a> = NULL;
<a name="l00279"></a>00279                 <span class="keywordflow">break</span>;
<a name="l00280"></a>00280             }
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a> = NULL;
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">/*****************************************************************************/</span>
<a name="l00288"></a>00288 
<a name="l00291"></a><a class="code" href="slave__config_8h.html#a6e141708e094e2e5ad9ea266696537af">00291</a> <span class="keywordtype">void</span> <a class="code" href="slave__config_8c.html#a3e2c05644e14f2168967f8559ab3ee35" title="Loads the default PDO assignment from the slave object.">ec_slave_config_load_default_sync_config</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293     uint8_t sync_index;
<a name="l00294"></a>00294     <a class="code" href="structec__sync__config__t.html" title="Sync manager configuration.">ec_sync_config_t</a> *sync_config;
<a name="l00295"></a>00295     <span class="keyword">const</span> <a class="code" href="structec__sync__t.html" title="Sync manager.">ec_sync_t</a> *sync;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (!sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>)
<a name="l00298"></a>00298         <span class="keywordflow">return</span>;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">for</span> (sync_index = 0; sync_index &lt; <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>; sync_index++) {
<a name="l00301"></a>00301         sync_config = &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index];
<a name="l00302"></a>00302         <span class="keywordflow">if</span> ((sync = <a class="code" href="slave_8c.html#a0a1f1035888d33dcd86a5ca5a5f3acc2" title="Get the sync manager given an index.">ec_slave_get_sync</a>(sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>, sync_index))) {
<a name="l00303"></a>00303             sync_config-&gt;<a class="code" href="structec__sync__config__t.html#a24246e2777a46c8aa69dcfbe6a32e4c7" title="Sync manager direction.">dir</a> = <a class="code" href="sync_8c.html#af820aa0417e581742c1ac9b65231c9da" title="Determines the default direction from the control register.">ec_sync_default_direction</a>(sync);
<a name="l00304"></a>00304             <span class="keywordflow">if</span> (sync_config-&gt;<a class="code" href="structec__sync__config__t.html#a24246e2777a46c8aa69dcfbe6a32e4c7" title="Sync manager direction.">dir</a> == <a class="code" href="group__ApplicationInterface.html#gga703c4e47384b3601e7605d6d910aaba1a1d65420e76eb63b731b1148054c40054" title="Invalid direction.">EC_DIR_INVALID</a>)
<a name="l00305"></a>00305                 <a class="code" href="slave_8h.html#aae2995e6509df66255d8f7fcdb5eb5bb" title="Convenience macro for printing slave-specific warnings to syslog.">EC_SLAVE_WARN</a>(sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>,
<a name="l00306"></a>00306                         <span class="stringliteral">&quot;SM%u has an invalid direction field!\n&quot;</span>, sync_index);
<a name="l00307"></a>00307             <a class="code" href="pdo__list_8c.html#accc8112633a4b76efe8df355d1ad0ec8" title="Makes a deep copy of another PDO list.">ec_pdo_list_copy</a>(&amp;sync_config-&gt;<a class="code" href="structec__sync__config__t.html#ae70642198065ad0381dacdfa21fcebaa" title="Current PDO assignment.">pdos</a>, &amp;sync-&gt;<a class="code" href="structec__sync__t.html#a96e5121c2fd258439b25d1a826ec5970" title="Current PDO assignment.">pdos</a>);
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="comment">/*****************************************************************************/</span>
<a name="l00313"></a>00313 
<a name="l00316"></a><a class="code" href="slave__config_8c.html#aa8e139fa8f726c589bccc8e5ee9447c2">00316</a> <span class="keywordtype">void</span> <a class="code" href="slave__config_8c.html#aa8e139fa8f726c589bccc8e5ee9447c2" title="Loads the default mapping for a PDO from the slave object.">ec_slave_config_load_default_mapping</a>(
<a name="l00317"></a>00317         <span class="keyword">const</span> <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00318"></a>00318         <a class="code" href="structec__pdo__t.html" title="PDO description.">ec_pdo_t</a> *pdo
<a name="l00319"></a>00319         )
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00322"></a>00322     <span class="keyword">const</span> <a class="code" href="structec__sync__t.html" title="Sync manager.">ec_sync_t</a> *sync;
<a name="l00323"></a>00323     <span class="keyword">const</span> <a class="code" href="structec__pdo__t.html" title="PDO description.">ec_pdo_t</a> *default_pdo;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (!sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>)
<a name="l00326"></a>00326         <span class="keywordflow">return</span>;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Loading default mapping for PDO 0x%04X.\n&quot;</span>,
<a name="l00329"></a>00329             pdo-&gt;<a class="code" href="structec__pdo__t.html#ae319ba9b8bed2ac49cf6596ff690cfdd" title="PDO index.">index</a>);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="comment">// find PDO in any sync manager (it could be reassigned later)</span>
<a name="l00332"></a>00332     <span class="keywordflow">for</span> (i = 0; i &lt; sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#add5337cd03f09660a3bfe91e4047ed2c" title="Number of sync managers.">sync_count</a>; i++) {
<a name="l00333"></a>00333         sync = &amp;sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#a1cfcfe4bdca850f302cbb8938affa7b9" title="SYNC MANAGER categories.">syncs</a>[i];
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         list_for_each_entry(default_pdo, &amp;sync-&gt;<a class="code" href="structec__sync__t.html#a96e5121c2fd258439b25d1a826ec5970" title="Current PDO assignment.">pdos</a>.<a class="code" href="structec__pdo__list__t.html#a7889b3f485d92c496fd15e45573cae21" title="List of PDOs.">list</a>, list) {
<a name="l00336"></a>00336             <span class="keywordflow">if</span> (default_pdo-&gt;<a class="code" href="structec__pdo__t.html#ae319ba9b8bed2ac49cf6596ff690cfdd" title="PDO index.">index</a> != pdo-&gt;<a class="code" href="structec__pdo__t.html#ae319ba9b8bed2ac49cf6596ff690cfdd" title="PDO index.">index</a>)
<a name="l00337"></a>00337                 <span class="keywordflow">continue</span>;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339             <span class="keywordflow">if</span> (default_pdo-&gt;<a class="code" href="structec__pdo__t.html#aee9c14db0de4c72475b8975d5630ad94" title="PDO name.">name</a>) {
<a name="l00340"></a>00340                 <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Found PDO name \&quot;%s\&quot;.\n&quot;</span>,
<a name="l00341"></a>00341                         default_pdo-&gt;<a class="code" href="structec__pdo__t.html#aee9c14db0de4c72475b8975d5630ad94" title="PDO name.">name</a>);
<a name="l00342"></a>00342 
<a name="l00343"></a>00343                 <span class="comment">// take PDO name from assigned one</span>
<a name="l00344"></a>00344                 <a class="code" href="pdo_8c.html#a8bd12e530ccbb342e5e4434d3464777a" title="Set PDO name.">ec_pdo_set_name</a>(pdo, default_pdo-&gt;<a class="code" href="structec__pdo__t.html#aee9c14db0de4c72475b8975d5630ad94" title="PDO name.">name</a>);
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347             <span class="comment">// copy entries (= default PDO mapping)</span>
<a name="l00348"></a>00348             <span class="keywordflow">if</span> (<a class="code" href="pdo_8c.html#a31ae386c7c51b495354db61f08e019a3" title="Copy PDO entries from another PDO.">ec_pdo_copy_entries</a>(pdo, default_pdo))
<a name="l00349"></a>00349                 <span class="keywordflow">return</span>;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351             <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#abdecf290f3f7f2af1b2a7bf0d9c7b08d" title="Master debug level.">debug_level</a>) {
<a name="l00352"></a>00352                 <span class="keyword">const</span> <a class="code" href="structec__pdo__entry__t.html" title="PDO entry description.">ec_pdo_entry_t</a> *entry;
<a name="l00353"></a>00353                 list_for_each_entry(entry, &amp;pdo-&gt;<a class="code" href="structec__pdo__t.html#aaac321c4f80081e5f69e2ff30eac80e5" title="List of PDO entries.">entries</a>, list) {
<a name="l00354"></a>00354                     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;Entry 0x%04X:%02X.\n&quot;</span>,
<a name="l00355"></a>00355                             entry-&gt;<a class="code" href="structec__pdo__entry__t.html#aede0b110f1a6f0e0df05081c85b14bf0" title="PDO entry index.">index</a>, entry-&gt;<a class="code" href="structec__pdo__entry__t.html#a959b16d415fbbb08a4997d858465a3be" title="PDO entry subindex.">subindex</a>);
<a name="l00356"></a>00356                 }
<a name="l00357"></a>00357             }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359             <span class="keywordflow">return</span>;
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;No default mapping found.\n&quot;</span>);
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 <span class="comment">/*****************************************************************************/</span>
<a name="l00367"></a>00367 
<a name="l00372"></a><a class="code" href="slave__config_8h.html#ae795e48b1a36b648bfc6c311b5515789">00372</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="slave__config_8c.html#ae0ad39c4f100b0d18140b38db27fa52f" title="Get the number of SDO configurations.">ec_slave_config_sdo_count</a>(
<a name="l00373"></a>00373         <span class="keyword">const</span> <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc 
<a name="l00374"></a>00374         )
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376     <span class="keyword">const</span> <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *req;
<a name="l00377"></a>00377     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count = 0;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     list_for_each_entry(req, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#aa980b60539d3818999fe9ba116851e1c" title="List of SDO configurations.">sdo_configs</a>, list) {
<a name="l00380"></a>00380         count++;
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">return</span> count;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="comment">/*****************************************************************************/</span>
<a name="l00387"></a>00387 
<a name="l00394"></a><a class="code" href="slave__config_8h.html#a8465a530f6397357f3b6559c70da3a36">00394</a> <span class="keyword">const</span> <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *<a class="code" href="slave__config_8c.html#ae6ccda0b55f86c5cd0e77ec5b51fac56" title="Finds an SDO configuration via its position in the list.">ec_slave_config_get_sdo_by_pos_const</a>(
<a name="l00395"></a>00395         <span class="keyword">const</span> <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, 
<a name="l00396"></a>00396         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos 
<a name="l00397"></a>00397         )
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399     <span class="keyword">const</span> <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *req;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     list_for_each_entry(req, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#aa980b60539d3818999fe9ba116851e1c" title="List of SDO configurations.">sdo_configs</a>, list) {
<a name="l00402"></a>00402         <span class="keywordflow">if</span> (pos--)
<a name="l00403"></a>00403             <span class="keywordflow">continue</span>;
<a name="l00404"></a>00404         <span class="keywordflow">return</span> req;
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="keywordflow">return</span> NULL;
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="comment">/*****************************************************************************/</span>
<a name="l00411"></a>00411 
<a name="l00416"></a><a class="code" href="slave__config_8h.html#aa8f308d05844508a60fa5e743b8781d3">00416</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="slave__config_8c.html#a833fa6107e6071bf7e37df298dcd41ac" title="Get the number of IDN configurations.">ec_slave_config_idn_count</a>(
<a name="l00417"></a>00417         <span class="keyword">const</span> <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc 
<a name="l00418"></a>00418         )
<a name="l00419"></a>00419 {
<a name="l00420"></a>00420     <span class="keyword">const</span> <a class="code" href="structec__soe__request__t.html" title="Sercos-over-EtherCAT request.">ec_soe_request_t</a> *req;
<a name="l00421"></a>00421     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count = 0;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     list_for_each_entry(req, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a9bfab1eba98284fcaa21079ea1700188" title="List of SoE configurations.">soe_configs</a>, list) {
<a name="l00424"></a>00424         count++;
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <span class="keywordflow">return</span> count;
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">/*****************************************************************************/</span>
<a name="l00431"></a>00431 
<a name="l00438"></a><a class="code" href="slave__config_8h.html#ad0f79036d990fb9b8b609302580b3136">00438</a> <span class="keyword">const</span> <a class="code" href="structec__soe__request__t.html" title="Sercos-over-EtherCAT request.">ec_soe_request_t</a> *<a class="code" href="slave__config_8c.html#a5767eb592be624ea3af8dfae05d7622d" title="Finds an IDN configuration via its position in the list.">ec_slave_config_get_idn_by_pos_const</a>(
<a name="l00439"></a>00439         <span class="keyword">const</span> <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, 
<a name="l00440"></a>00440         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos 
<a name="l00441"></a>00441         )
<a name="l00442"></a>00442 {
<a name="l00443"></a>00443     <span class="keyword">const</span> <a class="code" href="structec__soe__request__t.html" title="Sercos-over-EtherCAT request.">ec_soe_request_t</a> *req;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     list_for_each_entry(req, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a9bfab1eba98284fcaa21079ea1700188" title="List of SoE configurations.">soe_configs</a>, list) {
<a name="l00446"></a>00446         <span class="keywordflow">if</span> (pos--)
<a name="l00447"></a>00447             <span class="keywordflow">continue</span>;
<a name="l00448"></a>00448         <span class="keywordflow">return</span> req;
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <span class="keywordflow">return</span> NULL;
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="comment">/*****************************************************************************/</span>
<a name="l00455"></a>00455 
<a name="l00460"></a><a class="code" href="slave__config_8h.html#ab171d9cd640f7c30268e92632e919c02">00460</a> <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *<a class="code" href="slave__config_8c.html#a0e431ae80ee0465f6629ff33ef3e8290" title="Finds a CoE handler via its position in the list.">ec_slave_config_find_sdo_request</a>(
<a name="l00461"></a>00461         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, 
<a name="l00462"></a>00462         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos 
<a name="l00463"></a>00463         )
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465     <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *req;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     list_for_each_entry(req, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a51461cce3b38ac55be3e046c5e93a932" title="List of SDO requests.">sdo_requests</a>, list) {
<a name="l00468"></a>00468         <span class="keywordflow">if</span> (pos--)
<a name="l00469"></a>00469             <span class="keywordflow">continue</span>;
<a name="l00470"></a>00470         <span class="keywordflow">return</span> req;
<a name="l00471"></a>00471     }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="keywordflow">return</span> NULL;
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="comment">/*****************************************************************************/</span>
<a name="l00477"></a>00477 
<a name="l00482"></a><a class="code" href="slave__config_8h.html#aa1734ae1f8efd8a7f4504f64c0bc1c2e">00482</a> <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *<a class="code" href="slave__config_8c.html#a23fe8c4e37cd9bea5cc346edfd890963" title="Finds a register handler via its position in the list.">ec_slave_config_find_reg_request</a>(
<a name="l00483"></a>00483         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, 
<a name="l00484"></a>00484         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos 
<a name="l00485"></a>00485         )
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487     <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *reg;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     list_for_each_entry(reg, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a391b64268ec07ce78e7aa50c9641e436" title="List of register requests.">reg_requests</a>, list) {
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (pos--)
<a name="l00491"></a>00491             <span class="keywordflow">continue</span>;
<a name="l00492"></a>00492         <span class="keywordflow">return</span> reg;
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="keywordflow">return</span> NULL;
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 <span class="comment">/*****************************************************************************/</span>
<a name="l00499"></a>00499 
<a name="l00504"></a><a class="code" href="slave__config_8h.html#a8dd6f6985e8c7505b22d61816a312403">00504</a> <a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *<a class="code" href="slave__config_8c.html#ae096a128f1552f49f5f048a2a08a5beb" title="Finds a VoE handler via its position in the list.">ec_slave_config_find_voe_handler</a>(
<a name="l00505"></a>00505         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, 
<a name="l00506"></a>00506         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos 
<a name="l00507"></a>00507         )
<a name="l00508"></a>00508 {
<a name="l00509"></a>00509     <a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *voe;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     list_for_each_entry(voe, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#afab81a75365c94fde03e15446fe7cc9e" title="List of VoE handlers.">voe_handlers</a>, list) {
<a name="l00512"></a>00512         <span class="keywordflow">if</span> (pos--)
<a name="l00513"></a>00513             <span class="keywordflow">continue</span>;
<a name="l00514"></a>00514         <span class="keywordflow">return</span> voe;
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="keywordflow">return</span> NULL;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 <span class="comment">/******************************************************************************</span>
<a name="l00521"></a>00521 <span class="comment"> *  Application interface</span>
<a name="l00522"></a>00522 <span class="comment"> *****************************************************************************/</span>
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="group__ApplicationInterface.html#ga4ac6eae111bdbf1d4cd09fa2f965a887">00524</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga4ac6eae111bdbf1d4cd09fa2f965a887" title="Configure a sync manager.">ecrt_slave_config_sync_manager</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint8_t sync_index,
<a name="l00525"></a>00525         <a class="code" href="group__ApplicationInterface.html#ga703c4e47384b3601e7605d6d910aaba1" title="Direction type for PDO assignment functions.">ec_direction_t</a> dir, <a class="code" href="group__ApplicationInterface.html#gaa31bcc2beed6a1f62ec495337c239177" title="Watchdog mode for sync manager configuration.">ec_watchdog_mode_t</a> watchdog_mode)
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527     <a class="code" href="structec__sync__config__t.html" title="Sync manager configuration.">ec_sync_config_t</a> *sync_config;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;ecrt_slave_config_sync_manager(sc = 0x%p,&quot;</span>
<a name="l00530"></a>00530             <span class="stringliteral">&quot; sync_index = %u, dir = %i, watchdog_mode = %i)\n&quot;</span>,
<a name="l00531"></a>00531             sc, sync_index, dir, watchdog_mode);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (sync_index &gt;= <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>) {
<a name="l00534"></a>00534         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Invalid sync manager index %u!\n&quot;</span>, sync_index);
<a name="l00535"></a>00535         <span class="keywordflow">return</span> -ENOENT;
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (dir != <a class="code" href="group__ApplicationInterface.html#gga703c4e47384b3601e7605d6d910aaba1aebf26f1d5c09cf002af5b09d9cb59b78" title="Values written by the master.">EC_DIR_OUTPUT</a> &amp;&amp; dir != <a class="code" href="group__ApplicationInterface.html#gga703c4e47384b3601e7605d6d910aaba1a6b3c6b53010076d846724fec434512e4" title="Values read by the master.">EC_DIR_INPUT</a>) {
<a name="l00539"></a>00539         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Invalid direction %u!\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) dir);
<a name="l00540"></a>00540         <span class="keywordflow">return</span> -EINVAL;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     sync_config = &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index];
<a name="l00544"></a>00544     sync_config-&gt;<a class="code" href="structec__sync__config__t.html#a24246e2777a46c8aa69dcfbe6a32e4c7" title="Sync manager direction.">dir</a> = dir;
<a name="l00545"></a>00545     sync_config-&gt;<a class="code" href="structec__sync__config__t.html#a83c2bcdf7c5a9e6541b5f47c13a4d46d" title="Watchdog mode.">watchdog_mode</a> = watchdog_mode;
<a name="l00546"></a>00546     <span class="keywordflow">return</span> 0;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="comment">/*****************************************************************************/</span>
<a name="l00550"></a>00550 
<a name="l00551"></a><a class="code" href="group__ApplicationInterface.html#gaba67c3e575110297f9fdcffad573d367">00551</a> <span class="keywordtype">void</span> <a class="code" href="group__ApplicationInterface.html#gaba67c3e575110297f9fdcffad573d367" title="Configure a slave&#39;s watchdog times.">ecrt_slave_config_watchdog</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00552"></a>00552         uint16_t divider, uint16_t intervals)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, divider = %u, intervals = %u)\n&quot;</span>,
<a name="l00555"></a>00555             __func__, sc, divider, intervals);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     sc-&gt;<a class="code" href="structec__slave__config.html#aaa1db6b3136fa60412cbf8d1302c48e9" title="Watchdog divider as a number of 40ns intervals (see spec.">watchdog_divider</a> = divider;
<a name="l00558"></a>00558     sc-&gt;<a class="code" href="structec__slave__config.html#a51e0bd197191abd7a46fd3206575eccb" title="Process data watchdog intervals (see spec.">watchdog_intervals</a> = intervals;
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 <span class="comment">/*****************************************************************************/</span>
<a name="l00562"></a>00562 
<a name="l00563"></a><a class="code" href="group__ApplicationInterface.html#gaef2958fe19c088978857e7b91f692630">00563</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#gaef2958fe19c088978857e7b91f692630" title="Add a PDO to a sync manager&#39;s PDO assignment.">ecrt_slave_config_pdo_assign_add</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00564"></a>00564         uint8_t sync_index, uint16_t pdo_index)
<a name="l00565"></a>00565 {
<a name="l00566"></a>00566     <a class="code" href="structec__pdo__t.html" title="PDO description.">ec_pdo_t</a> *pdo;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, sync_index = %u, &quot;</span>
<a name="l00569"></a>00569             <span class="stringliteral">&quot;pdo_index = 0x%04X)\n&quot;</span>, __func__, sc, sync_index, pdo_index);
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="keywordflow">if</span> (sync_index &gt;= <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>) {
<a name="l00572"></a>00572         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Invalid sync manager index %u!\n&quot;</span>, sync_index);
<a name="l00573"></a>00573         <span class="keywordflow">return</span> -EINVAL;
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     pdo = <a class="code" href="pdo__list_8c.html#a19d7263b2fa2234b9d8301515528e834" title="Add a new PDO to the list.">ec_pdo_list_add_pdo</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index].<a class="code" href="structec__sync__config__t.html#ae70642198065ad0381dacdfa21fcebaa" title="Current PDO assignment.">pdos</a>, pdo_index);
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (IS_ERR(pdo)) {
<a name="l00580"></a>00580         up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00581"></a>00581         <span class="keywordflow">return</span> PTR_ERR(pdo);
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583     pdo-&gt;<a class="code" href="structec__pdo__t.html#ade04e761df137353930d271ed34120c9" title="Assigned sync manager.">sync_index</a> = sync_index;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <a class="code" href="slave__config_8c.html#aa8e139fa8f726c589bccc8e5ee9447c2" title="Loads the default mapping for a PDO from the slave object.">ec_slave_config_load_default_mapping</a>(sc, pdo);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00588"></a>00588     <span class="keywordflow">return</span> 0;
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 <span class="comment">/*****************************************************************************/</span>
<a name="l00592"></a>00592 
<a name="l00593"></a><a class="code" href="group__ApplicationInterface.html#gafc2fb2a662bd8129dea5330e5e313b5f">00593</a> <span class="keywordtype">void</span> <a class="code" href="group__ApplicationInterface.html#gafc2fb2a662bd8129dea5330e5e313b5f" title="Clear a sync manager&#39;s PDO assignment.">ecrt_slave_config_pdo_assign_clear</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00594"></a>00594         uint8_t sync_index)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, sync_index = %u)\n&quot;</span>,
<a name="l00597"></a>00597             __func__, sc, sync_index);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="keywordflow">if</span> (sync_index &gt;= <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>) {
<a name="l00600"></a>00600         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Invalid sync manager index %u!\n&quot;</span>, sync_index);
<a name="l00601"></a>00601         <span class="keywordflow">return</span>;
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00605"></a>00605     <a class="code" href="pdo__list_8c.html#aff8b6a50972c7106457f0db17fbeaf6c" title="Clears the list of mapped PDOs.">ec_pdo_list_clear_pdos</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index].<a class="code" href="structec__sync__config__t.html#ae70642198065ad0381dacdfa21fcebaa" title="Current PDO assignment.">pdos</a>);
<a name="l00606"></a>00606     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="comment">/*****************************************************************************/</span>
<a name="l00610"></a>00610 
<a name="l00611"></a><a class="code" href="group__ApplicationInterface.html#ga3a0f83e1c3e3edf978b3017f94cc375d">00611</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga3a0f83e1c3e3edf978b3017f94cc375d" title="Add a PDO entry to the given PDO&#39;s mapping.">ecrt_slave_config_pdo_mapping_add</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00612"></a>00612         uint16_t pdo_index, uint16_t entry_index, uint8_t entry_subindex,
<a name="l00613"></a>00613         uint8_t entry_bit_length)
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615     uint8_t sync_index;
<a name="l00616"></a>00616     <a class="code" href="structec__pdo__t.html" title="PDO description.">ec_pdo_t</a> *pdo = NULL;
<a name="l00617"></a>00617     <a class="code" href="structec__pdo__entry__t.html" title="PDO entry description.">ec_pdo_entry_t</a> *entry;
<a name="l00618"></a>00618     <span class="keywordtype">int</span> retval = 0;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, &quot;</span>
<a name="l00621"></a>00621             <span class="stringliteral">&quot;pdo_index = 0x%04X, entry_index = 0x%04X, &quot;</span>
<a name="l00622"></a>00622             <span class="stringliteral">&quot;entry_subindex = 0x%02X, entry_bit_length = %u)\n&quot;</span>,
<a name="l00623"></a>00623             __func__, sc, pdo_index, entry_index, entry_subindex,
<a name="l00624"></a>00624             entry_bit_length);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="keywordflow">for</span> (sync_index = 0; sync_index &lt; <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>; sync_index++)
<a name="l00627"></a>00627         <span class="keywordflow">if</span> ((pdo = <a class="code" href="pdo__list_8c.html#ab08f37fcf3beda7d5425d49eca02c3be" title="Finds a PDO with the given index.">ec_pdo_list_find_pdo</a>(
<a name="l00628"></a>00628                         &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index].<a class="code" href="structec__sync__config__t.html#ae70642198065ad0381dacdfa21fcebaa" title="Current PDO assignment.">pdos</a>, pdo_index)))
<a name="l00629"></a>00629             <span class="keywordflow">break</span>;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="keywordflow">if</span> (pdo) {
<a name="l00632"></a>00632         down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00633"></a>00633         entry = <a class="code" href="pdo_8c.html#a2df3cd7ded1048aa232f2f5c19a07229" title="Add a new PDO entry to the configuration.">ec_pdo_add_entry</a>(pdo, entry_index, entry_subindex,
<a name="l00634"></a>00634                 entry_bit_length);
<a name="l00635"></a>00635         up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00636"></a>00636         <span class="keywordflow">if</span> (IS_ERR(entry))
<a name="l00637"></a>00637             retval = PTR_ERR(entry);
<a name="l00638"></a>00638     } <span class="keywordflow">else</span> {
<a name="l00639"></a>00639         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;PDO 0x%04X is not assigned.\n&quot;</span>, pdo_index);
<a name="l00640"></a>00640         retval = -ENOENT;
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <span class="keywordflow">return</span> retval;
<a name="l00644"></a>00644 }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 <span class="comment">/*****************************************************************************/</span>
<a name="l00647"></a>00647 
<a name="l00648"></a><a class="code" href="group__ApplicationInterface.html#ga8496abee3bd32fec5ffd74bf4705cc53">00648</a> <span class="keywordtype">void</span> <a class="code" href="group__ApplicationInterface.html#ga8496abee3bd32fec5ffd74bf4705cc53" title="Clear the mapping of a given PDO.">ecrt_slave_config_pdo_mapping_clear</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00649"></a>00649         uint16_t pdo_index)
<a name="l00650"></a>00650 {
<a name="l00651"></a>00651     uint8_t sync_index;
<a name="l00652"></a>00652     <a class="code" href="structec__pdo__t.html" title="PDO description.">ec_pdo_t</a> *pdo = NULL;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, pdo_index = 0x%04X)\n&quot;</span>,
<a name="l00655"></a>00655             __func__, sc, pdo_index);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">for</span> (sync_index = 0; sync_index &lt; <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>; sync_index++)
<a name="l00658"></a>00658         <span class="keywordflow">if</span> ((pdo = <a class="code" href="pdo__list_8c.html#ab08f37fcf3beda7d5425d49eca02c3be" title="Finds a PDO with the given index.">ec_pdo_list_find_pdo</a>(
<a name="l00659"></a>00659                         &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index].<a class="code" href="structec__sync__config__t.html#ae70642198065ad0381dacdfa21fcebaa" title="Current PDO assignment.">pdos</a>, pdo_index)))
<a name="l00660"></a>00660             <span class="keywordflow">break</span>;
<a name="l00661"></a>00661 
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (pdo) {
<a name="l00663"></a>00663         down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00664"></a>00664         <a class="code" href="pdo_8c.html#a399136c28e710fa96af02e46c0351dbb" title="Clear PDO entry list.">ec_pdo_clear_entries</a>(pdo);
<a name="l00665"></a>00665         up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00666"></a>00666     } <span class="keywordflow">else</span> {
<a name="l00667"></a>00667         <a class="code" href="slave__config_8h.html#a3115d8b69eddec5caf436c109fbf5b41" title="Convenience macro for printing configuration-specific warnings to syslog.">EC_CONFIG_WARN</a>(sc, <span class="stringliteral">&quot;PDO 0x%04X is not assigned.\n&quot;</span>, pdo_index);
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <span class="comment">/*****************************************************************************/</span>
<a name="l00672"></a>00672 
<a name="l00673"></a><a class="code" href="group__ApplicationInterface.html#ga7bc2683699a5c0c551f0cfdc90c1a559">00673</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga7bc2683699a5c0c551f0cfdc90c1a559" title="Specify a complete PDO configuration.">ecrt_slave_config_pdos</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00674"></a>00674         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_syncs, <span class="keyword">const</span> <a class="code" href="structec__sync__info__t.html" title="Sync manager configuration information.">ec_sync_info_t</a> syncs[])
<a name="l00675"></a>00675 {
<a name="l00676"></a>00676     <span class="keywordtype">int</span> ret;
<a name="l00677"></a>00677     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j, k;
<a name="l00678"></a>00678     <span class="keyword">const</span> <a class="code" href="structec__sync__info__t.html" title="Sync manager configuration information.">ec_sync_info_t</a> *sync_info;
<a name="l00679"></a>00679     <span class="keyword">const</span> <a class="code" href="structec__pdo__info__t.html" title="PDO configuration information.">ec_pdo_info_t</a> *pdo_info;
<a name="l00680"></a>00680     <span class="keyword">const</span> <a class="code" href="structec__pdo__entry__info__t.html" title="PDO entry configuration information.">ec_pdo_entry_info_t</a> *entry_info;
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, n_syncs = %u, syncs = 0x%p)\n&quot;</span>,
<a name="l00683"></a>00683             __func__, sc, n_syncs, syncs);
<a name="l00684"></a>00684 
<a name="l00685"></a>00685     <span class="keywordflow">if</span> (!syncs)
<a name="l00686"></a>00686         <span class="keywordflow">return</span> 0;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     <span class="keywordflow">for</span> (i = 0; i &lt; n_syncs; i++) {
<a name="l00689"></a>00689         sync_info = &amp;syncs[i];
<a name="l00690"></a>00690 
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a87956061ffbec80e40b2aa7a3c65791c" title="Sync manager index.">index</a> == (uint8_t) <a class="code" href="group__ApplicationInterface.html#gab2c6b7c61e0a7e07671003c1954d92ee" title="End of list marker.">EC_END</a>)
<a name="l00692"></a>00692             <span class="keywordflow">break</span>;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694         <span class="keywordflow">if</span> (sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a87956061ffbec80e40b2aa7a3c65791c" title="Sync manager index.">index</a> &gt;= <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>) {
<a name="l00695"></a>00695             <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Invalid sync manager index %u!\n&quot;</span>,
<a name="l00696"></a>00696                     sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a87956061ffbec80e40b2aa7a3c65791c" title="Sync manager index.">index</a>);
<a name="l00697"></a>00697             <span class="keywordflow">return</span> -ENOENT;
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         ret = <a class="code" href="group__ApplicationInterface.html#ga4ac6eae111bdbf1d4cd09fa2f965a887" title="Configure a sync manager.">ecrt_slave_config_sync_manager</a>(sc, sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a87956061ffbec80e40b2aa7a3c65791c" title="Sync manager index.">index</a>,
<a name="l00701"></a>00701                 sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a30a8f40bfcbda77239378f0cef039c70" title="Sync manager direction.">dir</a>, sync_info-&gt;<a class="code" href="structec__sync__info__t.html#abeb91973efe10dd69ce8fb57135e8253" title="Watchdog mode.">watchdog_mode</a>);
<a name="l00702"></a>00702         <span class="keywordflow">if</span> (ret)
<a name="l00703"></a>00703             <span class="keywordflow">return</span> ret;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         <span class="keywordflow">if</span> (sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a25e3f4601c01b018bef363e3f3a3d38d" title="Number of PDOs in pdos.">n_pdos</a> &amp;&amp; sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a1a9322a8f1da38ce383542374108b76d" title="Array with PDOs to assign.">pdos</a>) {
<a name="l00706"></a>00706             <a class="code" href="group__ApplicationInterface.html#gafc2fb2a662bd8129dea5330e5e313b5f" title="Clear a sync manager&#39;s PDO assignment.">ecrt_slave_config_pdo_assign_clear</a>(sc, sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a87956061ffbec80e40b2aa7a3c65791c" title="Sync manager index.">index</a>);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708             <span class="keywordflow">for</span> (j = 0; j &lt; sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a25e3f4601c01b018bef363e3f3a3d38d" title="Number of PDOs in pdos.">n_pdos</a>; j++) {
<a name="l00709"></a>00709                 pdo_info = &amp;sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a1a9322a8f1da38ce383542374108b76d" title="Array with PDOs to assign.">pdos</a>[j];
<a name="l00710"></a>00710 
<a name="l00711"></a>00711                 ret = <a class="code" href="group__ApplicationInterface.html#gaef2958fe19c088978857e7b91f692630" title="Add a PDO to a sync manager&#39;s PDO assignment.">ecrt_slave_config_pdo_assign_add</a>(
<a name="l00712"></a>00712                         sc, sync_info-&gt;<a class="code" href="structec__sync__info__t.html#a87956061ffbec80e40b2aa7a3c65791c" title="Sync manager index.">index</a>, pdo_info-&gt;<a class="code" href="structec__pdo__info__t.html#a90f9554694041aefded6f069e0b003d3" title="PDO index.">index</a>);
<a name="l00713"></a>00713                 <span class="keywordflow">if</span> (ret)
<a name="l00714"></a>00714                     <span class="keywordflow">return</span> ret;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716                 <span class="keywordflow">if</span> (pdo_info-&gt;<a class="code" href="structec__pdo__info__t.html#a64eb03ac59c0d0cb771b6c32bf52de74" title="Number of PDO entries in entries to map.">n_entries</a> &amp;&amp; pdo_info-&gt;<a class="code" href="structec__pdo__info__t.html#a625680a1ef38138a5d0298c70ba6f4b1" title="Array of PDO entries to map.">entries</a>) {
<a name="l00717"></a>00717                     <a class="code" href="group__ApplicationInterface.html#ga8496abee3bd32fec5ffd74bf4705cc53" title="Clear the mapping of a given PDO.">ecrt_slave_config_pdo_mapping_clear</a>(sc, pdo_info-&gt;<a class="code" href="structec__pdo__info__t.html#a90f9554694041aefded6f069e0b003d3" title="PDO index.">index</a>);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719                     <span class="keywordflow">for</span> (k = 0; k &lt; pdo_info-&gt;<a class="code" href="structec__pdo__info__t.html#a64eb03ac59c0d0cb771b6c32bf52de74" title="Number of PDO entries in entries to map.">n_entries</a>; k++) {
<a name="l00720"></a>00720                         entry_info = &amp;pdo_info-&gt;<a class="code" href="structec__pdo__info__t.html#a625680a1ef38138a5d0298c70ba6f4b1" title="Array of PDO entries to map.">entries</a>[k];
<a name="l00721"></a>00721 
<a name="l00722"></a>00722                         ret = <a class="code" href="group__ApplicationInterface.html#ga3a0f83e1c3e3edf978b3017f94cc375d" title="Add a PDO entry to the given PDO&#39;s mapping.">ecrt_slave_config_pdo_mapping_add</a>(sc,
<a name="l00723"></a>00723                                 pdo_info-&gt;<a class="code" href="structec__pdo__info__t.html#a90f9554694041aefded6f069e0b003d3" title="PDO index.">index</a>, entry_info-&gt;<a class="code" href="structec__pdo__entry__info__t.html#afce51f4c58abe5d43b41b2edaa60707c" title="PDO entry index.">index</a>,
<a name="l00724"></a>00724                                 entry_info-&gt;<a class="code" href="structec__pdo__entry__info__t.html#a8547bec4e178409bdc8090ddd7e97c05" title="PDO entry subindex.">subindex</a>,
<a name="l00725"></a>00725                                 entry_info-&gt;<a class="code" href="structec__pdo__entry__info__t.html#a87da50fb38483fd43e88721f6b99033c" title="Size of the PDO entry in bit.">bit_length</a>);
<a name="l00726"></a>00726                         <span class="keywordflow">if</span> (ret)
<a name="l00727"></a>00727                             <span class="keywordflow">return</span> ret;
<a name="l00728"></a>00728                     }
<a name="l00729"></a>00729                 }
<a name="l00730"></a>00730             }
<a name="l00731"></a>00731         }
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     <span class="keywordflow">return</span> 0;
<a name="l00735"></a>00735 }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 <span class="comment">/*****************************************************************************/</span>
<a name="l00738"></a>00738 
<a name="l00739"></a><a class="code" href="group__ApplicationInterface.html#ga44fe6bd549328c34ca4ed6893765206f">00739</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga44fe6bd549328c34ca4ed6893765206f" title="Registers a PDO entry for process data exchange in a domain.">ecrt_slave_config_reg_pdo_entry</a>(
<a name="l00740"></a>00740         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00741"></a>00741         uint16_t index,
<a name="l00742"></a>00742         uint8_t subindex,
<a name="l00743"></a>00743         <a class="code" href="structec__domain.html" title="EtherCAT domain.">ec_domain_t</a> *domain,
<a name="l00744"></a>00744         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *bit_position
<a name="l00745"></a>00745         )
<a name="l00746"></a>00746 {
<a name="l00747"></a>00747     uint8_t sync_index;
<a name="l00748"></a>00748     <span class="keyword">const</span> <a class="code" href="structec__sync__config__t.html" title="Sync manager configuration.">ec_sync_config_t</a> *sync_config;
<a name="l00749"></a>00749     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bit_offset, bit_pos;
<a name="l00750"></a>00750     <a class="code" href="structec__pdo__t.html" title="PDO description.">ec_pdo_t</a> *pdo;
<a name="l00751"></a>00751     <a class="code" href="structec__pdo__entry__t.html" title="PDO entry description.">ec_pdo_entry_t</a> *entry;
<a name="l00752"></a>00752     <span class="keywordtype">int</span> sync_offset;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, index = 0x%04X, &quot;</span>
<a name="l00755"></a>00755             <span class="stringliteral">&quot;subindex = 0x%02X, domain = 0x%p, bit_position = 0x%p)\n&quot;</span>,
<a name="l00756"></a>00756             __func__, sc, index, subindex, domain, bit_position);
<a name="l00757"></a>00757 
<a name="l00758"></a>00758     <span class="keywordflow">for</span> (sync_index = 0; sync_index &lt; <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>; sync_index++) {
<a name="l00759"></a>00759         sync_config = &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index];
<a name="l00760"></a>00760         bit_offset = 0;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762         list_for_each_entry(pdo, &amp;sync_config-&gt;<a class="code" href="structec__sync__config__t.html#ae70642198065ad0381dacdfa21fcebaa" title="Current PDO assignment.">pdos</a>.<a class="code" href="structec__pdo__list__t.html#a7889b3f485d92c496fd15e45573cae21" title="List of PDOs.">list</a>, list) {
<a name="l00763"></a>00763             list_for_each_entry(entry, &amp;pdo-&gt;<a class="code" href="structec__pdo__t.html#aaac321c4f80081e5f69e2ff30eac80e5" title="List of PDO entries.">entries</a>, list) {
<a name="l00764"></a>00764                 <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="structec__pdo__entry__t.html#aede0b110f1a6f0e0df05081c85b14bf0" title="PDO entry index.">index</a> != index || entry-&gt;<a class="code" href="structec__pdo__entry__t.html#a959b16d415fbbb08a4997d858465a3be" title="PDO entry subindex.">subindex</a> != subindex) {
<a name="l00765"></a>00765                     bit_offset += entry-&gt;<a class="code" href="structec__pdo__entry__t.html#a589e58c4f0eb47d8916a3da125d09176" title="entry length in bit">bit_length</a>;
<a name="l00766"></a>00766                 } <span class="keywordflow">else</span> {
<a name="l00767"></a>00767                     bit_pos = bit_offset % 8;
<a name="l00768"></a>00768                     <span class="keywordflow">if</span> (bit_position) {
<a name="l00769"></a>00769                         *bit_position = bit_pos;
<a name="l00770"></a>00770                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bit_pos) {
<a name="l00771"></a>00771                         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;PDO entry 0x%04X:%02X does&quot;</span>
<a name="l00772"></a>00772                                 <span class="stringliteral">&quot; not byte-align.\n&quot;</span>, index, subindex);
<a name="l00773"></a>00773                         <span class="keywordflow">return</span> -EFAULT;
<a name="l00774"></a>00774                     }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776                     sync_offset = <a class="code" href="slave__config_8c.html#a6c908bc3c5044575e96e5dc1554c9bc1" title="Prepares an FMMU configuration.">ec_slave_config_prepare_fmmu</a>(
<a name="l00777"></a>00777                             sc, domain, sync_index, sync_config-&gt;<a class="code" href="structec__sync__config__t.html#a24246e2777a46c8aa69dcfbe6a32e4c7" title="Sync manager direction.">dir</a>);
<a name="l00778"></a>00778                     <span class="keywordflow">if</span> (sync_offset &lt; 0)
<a name="l00779"></a>00779                         <span class="keywordflow">return</span> sync_offset;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781                     <span class="keywordflow">return</span> sync_offset + bit_offset / 8;
<a name="l00782"></a>00782                 }
<a name="l00783"></a>00783             }
<a name="l00784"></a>00784         }
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;PDO entry 0x%04X:%02X is not mapped.\n&quot;</span>,
<a name="l00788"></a>00788            index, subindex);
<a name="l00789"></a>00789     <span class="keywordflow">return</span> -ENOENT;
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 <span class="comment">/*****************************************************************************/</span>
<a name="l00793"></a>00793 
<a name="l00794"></a><a class="code" href="group__ApplicationInterface.html#ga757fd3d421f1ded8ee310c4698afb8ba">00794</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga757fd3d421f1ded8ee310c4698afb8ba" title="Registers a PDO entry using its position.">ecrt_slave_config_reg_pdo_entry_pos</a>(
<a name="l00795"></a>00795         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l00796"></a>00796         uint8_t sync_index,
<a name="l00797"></a>00797         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pdo_pos,
<a name="l00798"></a>00798         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> entry_pos,
<a name="l00799"></a>00799         <a class="code" href="structec__domain.html" title="EtherCAT domain.">ec_domain_t</a> *domain,
<a name="l00800"></a>00800         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *bit_position
<a name="l00801"></a>00801         )
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803     <span class="keyword">const</span> <a class="code" href="structec__sync__config__t.html" title="Sync manager configuration.">ec_sync_config_t</a> *sync_config;
<a name="l00804"></a>00804     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bit_offset, pp, ep;
<a name="l00805"></a>00805     <a class="code" href="structec__pdo__t.html" title="PDO description.">ec_pdo_t</a> *pdo;
<a name="l00806"></a>00806     <a class="code" href="structec__pdo__entry__t.html" title="PDO entry description.">ec_pdo_entry_t</a> *entry;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, sync_index = %u, pdo_pos = %u,&quot;</span>
<a name="l00809"></a>00809             <span class="stringliteral">&quot; entry_pos = %u, domain = 0x%p, bit_position = 0x%p)\n&quot;</span>,
<a name="l00810"></a>00810             __func__, sc, sync_index, pdo_pos, entry_pos,
<a name="l00811"></a>00811             domain, bit_position);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     <span class="keywordflow">if</span> (sync_index &gt;= <a class="code" href="group__ApplicationInterface.html#gab737cd2955a397ebd0df13e9148cec9f" title="Maximum number of sync managers per slave.">EC_MAX_SYNC_MANAGERS</a>) {
<a name="l00814"></a>00814         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Invalid syncmanager position %u.\n&quot;</span>, sync_index);
<a name="l00815"></a>00815         <span class="keywordflow">return</span> -EINVAL;
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818     sync_config = &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a28bf292a581f2af8696f41fa333ba0f3" title="Sync manager configurations.">sync_configs</a>[sync_index];
<a name="l00819"></a>00819     bit_offset = 0;
<a name="l00820"></a>00820     pp = 0;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     list_for_each_entry(pdo, &amp;sync_config-&gt;<a class="code" href="structec__sync__config__t.html#ae70642198065ad0381dacdfa21fcebaa" title="Current PDO assignment.">pdos</a>.<a class="code" href="structec__pdo__list__t.html#a7889b3f485d92c496fd15e45573cae21" title="List of PDOs.">list</a>, list) {
<a name="l00823"></a>00823         ep = 0;
<a name="l00824"></a>00824         list_for_each_entry(entry, &amp;pdo-&gt;<a class="code" href="structec__pdo__t.html#aaac321c4f80081e5f69e2ff30eac80e5" title="List of PDO entries.">entries</a>, list) {
<a name="l00825"></a>00825             <span class="keywordflow">if</span> (pp != pdo_pos || ep != entry_pos) {
<a name="l00826"></a>00826                 bit_offset += entry-&gt;<a class="code" href="structec__pdo__entry__t.html#a589e58c4f0eb47d8916a3da125d09176" title="entry length in bit">bit_length</a>;
<a name="l00827"></a>00827             } <span class="keywordflow">else</span> {
<a name="l00828"></a>00828                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bit_pos = bit_offset % 8;
<a name="l00829"></a>00829                 <span class="keywordtype">int</span> sync_offset;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831                 <span class="keywordflow">if</span> (bit_position) {
<a name="l00832"></a>00832                     *bit_position = bit_pos;
<a name="l00833"></a>00833                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bit_pos) {
<a name="l00834"></a>00834                     <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;PDO entry 0x%04X:%02X does&quot;</span>
<a name="l00835"></a>00835                             <span class="stringliteral">&quot; not byte-align.\n&quot;</span>,
<a name="l00836"></a>00836                             pdo-&gt;<a class="code" href="structec__pdo__t.html#ae319ba9b8bed2ac49cf6596ff690cfdd" title="PDO index.">index</a>, entry-&gt;<a class="code" href="structec__pdo__entry__t.html#a959b16d415fbbb08a4997d858465a3be" title="PDO entry subindex.">subindex</a>);
<a name="l00837"></a>00837                     <span class="keywordflow">return</span> -EFAULT;
<a name="l00838"></a>00838                 }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840                 sync_offset = <a class="code" href="slave__config_8c.html#a6c908bc3c5044575e96e5dc1554c9bc1" title="Prepares an FMMU configuration.">ec_slave_config_prepare_fmmu</a>(
<a name="l00841"></a>00841                         sc, domain, sync_index, sync_config-&gt;<a class="code" href="structec__sync__config__t.html#a24246e2777a46c8aa69dcfbe6a32e4c7" title="Sync manager direction.">dir</a>);
<a name="l00842"></a>00842                 <span class="keywordflow">if</span> (sync_offset &lt; 0)
<a name="l00843"></a>00843                     <span class="keywordflow">return</span> sync_offset;
<a name="l00844"></a>00844 
<a name="l00845"></a>00845                 <span class="keywordflow">return</span> sync_offset + bit_offset / 8;
<a name="l00846"></a>00846             }
<a name="l00847"></a>00847             ep++;
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849         pp++;
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852     <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;PDO entry specification %u/%u/%u out of range.\n&quot;</span>,
<a name="l00853"></a>00853            sync_index, pdo_pos, entry_pos);
<a name="l00854"></a>00854     <span class="keywordflow">return</span> -ENOENT;
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 <span class="comment">/*****************************************************************************/</span>
<a name="l00858"></a>00858 
<a name="l00859"></a><a class="code" href="group__ApplicationInterface.html#ga05858fdb5052dfb1161a81d2f8beb553">00859</a> <span class="keywordtype">void</span> <a class="code" href="group__ApplicationInterface.html#ga05858fdb5052dfb1161a81d2f8beb553" title="Configure distributed clocks.">ecrt_slave_config_dc</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t assign_activate,
<a name="l00860"></a>00860         uint32_t sync0_cycle_time, int32_t sync0_shift_time,
<a name="l00861"></a>00861         uint32_t sync1_cycle_time, int32_t sync1_shift_time)
<a name="l00862"></a>00862 {
<a name="l00863"></a>00863     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, assign_activate = 0x%04X,&quot;</span>
<a name="l00864"></a>00864             <span class="stringliteral">&quot; sync0_cycle = %u, sync0_shift = %i,&quot;</span>
<a name="l00865"></a>00865             <span class="stringliteral">&quot; sync1_cycle = %u, sync1_shift = %i\n&quot;</span>,
<a name="l00866"></a>00866             __func__, sc, assign_activate, sync0_cycle_time, sync0_shift_time,
<a name="l00867"></a>00867             sync1_cycle_time, sync1_shift_time);
<a name="l00868"></a>00868 
<a name="l00869"></a>00869     sc-&gt;<a class="code" href="structec__slave__config.html#a444000aa859f4830053b65518fc65233" title="Vendor-specific AssignActivate word.">dc_assign_activate</a> = assign_activate;
<a name="l00870"></a>00870     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[0].<a class="code" href="structec__sync__signal__t.html#a584e9c4963c35777cfc06838793e20e0" title="Cycle time [ns].">cycle_time</a> = sync0_cycle_time;
<a name="l00871"></a>00871     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[0].<a class="code" href="structec__sync__signal__t.html#a75c1a27b0421473e05bf737fd0d38368" title="Shift time [ns].">shift_time</a> = sync0_shift_time;
<a name="l00872"></a>00872     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[1].<a class="code" href="structec__sync__signal__t.html#a584e9c4963c35777cfc06838793e20e0" title="Cycle time [ns].">cycle_time</a> = sync1_cycle_time;
<a name="l00873"></a>00873     sc-&gt;<a class="code" href="structec__slave__config.html#a947ad2e8f2573df6655965524575c5b8" title="DC sync signals.">dc_sync</a>[1].<a class="code" href="structec__sync__signal__t.html#a75c1a27b0421473e05bf737fd0d38368" title="Shift time [ns].">shift_time</a> = sync1_shift_time;
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="comment">/*****************************************************************************/</span>
<a name="l00877"></a>00877 
<a name="l00878"></a><a class="code" href="group__ApplicationInterface.html#gacf5b3147d6fa082ed73417cf7aa4e240">00878</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#gacf5b3147d6fa082ed73417cf7aa4e240" title="Add an SDO configuration.">ecrt_slave_config_sdo</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t index,
<a name="l00879"></a>00879         uint8_t subindex, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> size)
<a name="l00880"></a>00880 {
<a name="l00881"></a>00881     <a class="code" href="structec__slave.html" title="EtherCAT slave.">ec_slave_t</a> *slave = sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>;
<a name="l00882"></a>00882     <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *req;
<a name="l00883"></a>00883     <span class="keywordtype">int</span> ret;
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, index = 0x%04X, &quot;</span>
<a name="l00886"></a>00886             <span class="stringliteral">&quot;subindex = 0x%02X, data = 0x%p, size = %zu)\n&quot;</span>,
<a name="l00887"></a>00887             __func__, sc, index, subindex, data, size);
<a name="l00888"></a>00888 
<a name="l00889"></a>00889     <span class="keywordflow">if</span> (slave &amp;&amp; !(slave-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#a7740732efd267741b956b8912502d8a1" title="Supported mailbox protocols.">mailbox_protocols</a> &amp; <a class="code" href="globals_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a228d7270dad743f55f7d42719e406076" title="CANopen over EtherCAT.">EC_MBOX_COE</a>)) {
<a name="l00890"></a>00890         <a class="code" href="slave__config_8h.html#a3115d8b69eddec5caf436c109fbf5b41" title="Convenience macro for printing configuration-specific warnings to syslog.">EC_CONFIG_WARN</a>(sc, <span class="stringliteral">&quot;Attached slave does not support CoE!\n&quot;</span>);
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     <span class="keywordflow">if</span> (!(req = (<a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *)
<a name="l00894"></a>00894           kmalloc(<span class="keyword">sizeof</span>(<a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a>), GFP_KERNEL))) {
<a name="l00895"></a>00895         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Failed to allocate memory for&quot;</span>
<a name="l00896"></a>00896                 <span class="stringliteral">&quot; SDO configuration!\n&quot;</span>);
<a name="l00897"></a>00897         <span class="keywordflow">return</span> -ENOMEM;
<a name="l00898"></a>00898     }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900     <a class="code" href="sdo__request_8c.html#a0e62e96b9d01ab1b89cc2df89d0ac8ef" title="SDO request constructor.">ec_sdo_request_init</a>(req);
<a name="l00901"></a>00901     <a class="code" href="group__ApplicationInterface.html#gae002eb267f69d91de0c83a5f4f349372" title="Set the SDO index and subindex.">ecrt_sdo_request_index</a>(req, index, subindex);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     ret = <a class="code" href="sdo__request_8c.html#af41428fb76fbb3a2bcf14a269a265476" title="Copies SDO data from an external source.">ec_sdo_request_copy_data</a>(req, data, size);
<a name="l00904"></a>00904     <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00905"></a>00905         <a class="code" href="sdo__request_8c.html#af3a555948ca6b916238e6c696d676645" title="SDO request destructor.">ec_sdo_request_clear</a>(req);
<a name="l00906"></a>00906         kfree(req);
<a name="l00907"></a>00907         <span class="keywordflow">return</span> ret;
<a name="l00908"></a>00908     }
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00911"></a>00911     list_add_tail(&amp;req-&gt;<a class="code" href="structec__sdo__request.html#a80c68878d98d613513a0b985be43198e" title="List item.">list</a>, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#aa980b60539d3818999fe9ba116851e1c" title="List of SDO configurations.">sdo_configs</a>);
<a name="l00912"></a>00912     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00913"></a>00913     <span class="keywordflow">return</span> 0;
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916 <span class="comment">/*****************************************************************************/</span>
<a name="l00917"></a>00917 
<a name="l00918"></a><a class="code" href="group__ApplicationInterface.html#ga93e038f9065d20ea3fa5738c495f0ae5">00918</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga93e038f9065d20ea3fa5738c495f0ae5" title="Add a configuration value for an 8-bit SDO.">ecrt_slave_config_sdo8</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t index,
<a name="l00919"></a>00919         uint8_t subindex, uint8_t value)
<a name="l00920"></a>00920 {
<a name="l00921"></a>00921     uint8_t data[1];
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, index = 0x%04X, &quot;</span>
<a name="l00924"></a>00924             <span class="stringliteral">&quot;subindex = 0x%02X, value = %u)\n&quot;</span>,
<a name="l00925"></a>00925             __func__, sc, index, subindex, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) value);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <a class="code" href="group__ApplicationInterface.html#ga42e7df5376954bc1cf1dde11fbf17387" title="Write an 8-bit unsigned value to EtherCAT data.">EC_WRITE_U8</a>(data, value);
<a name="l00928"></a>00928     <span class="keywordflow">return</span> <a class="code" href="group__ApplicationInterface.html#gacf5b3147d6fa082ed73417cf7aa4e240" title="Add an SDO configuration.">ecrt_slave_config_sdo</a>(sc, index, subindex, data, 1);
<a name="l00929"></a>00929 }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931 <span class="comment">/*****************************************************************************/</span>
<a name="l00932"></a>00932 
<a name="l00933"></a><a class="code" href="group__ApplicationInterface.html#gaacb7fefc226e3a3c0225c39d233d2fa8">00933</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#gaacb7fefc226e3a3c0225c39d233d2fa8" title="Add a configuration value for a 16-bit SDO.">ecrt_slave_config_sdo16</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t index,
<a name="l00934"></a>00934         uint8_t subindex, uint16_t value)
<a name="l00935"></a>00935 {
<a name="l00936"></a>00936     uint8_t data[2];
<a name="l00937"></a>00937 
<a name="l00938"></a>00938     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, index = 0x%04X, &quot;</span>
<a name="l00939"></a>00939             <span class="stringliteral">&quot;subindex = 0x%02X, value = %u)\n&quot;</span>,
<a name="l00940"></a>00940             __func__, sc, index, subindex, value);
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     <a class="code" href="group__ApplicationInterface.html#gace219530ddd83f5f3f54d5b329b94a3d" title="Write a 16-bit unsigned value to EtherCAT data.">EC_WRITE_U16</a>(data, value);
<a name="l00943"></a>00943     <span class="keywordflow">return</span> <a class="code" href="group__ApplicationInterface.html#gacf5b3147d6fa082ed73417cf7aa4e240" title="Add an SDO configuration.">ecrt_slave_config_sdo</a>(sc, index, subindex, data, 2);
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946 <span class="comment">/*****************************************************************************/</span>
<a name="l00947"></a>00947 
<a name="l00948"></a><a class="code" href="group__ApplicationInterface.html#ga0a87e59a5448389907652ddb2f5768fd">00948</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga0a87e59a5448389907652ddb2f5768fd" title="Add a configuration value for a 32-bit SDO.">ecrt_slave_config_sdo32</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t index,
<a name="l00949"></a>00949         uint8_t subindex, uint32_t value)
<a name="l00950"></a>00950 {
<a name="l00951"></a>00951     uint8_t data[4];
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, index = 0x%04X, &quot;</span>
<a name="l00954"></a>00954             <span class="stringliteral">&quot;subindex = 0x%02X, value = %u)\n&quot;</span>,
<a name="l00955"></a>00955             __func__, sc, index, subindex, value);
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     <a class="code" href="group__ApplicationInterface.html#ga9558cb79cc4015da0a551704649d1e80" title="Write a 32-bit unsigned value to EtherCAT data.">EC_WRITE_U32</a>(data, value);
<a name="l00958"></a>00958     <span class="keywordflow">return</span> <a class="code" href="group__ApplicationInterface.html#gacf5b3147d6fa082ed73417cf7aa4e240" title="Add an SDO configuration.">ecrt_slave_config_sdo</a>(sc, index, subindex, data, 4);
<a name="l00959"></a>00959 }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 <span class="comment">/*****************************************************************************/</span>
<a name="l00962"></a>00962 
<a name="l00963"></a><a class="code" href="group__ApplicationInterface.html#ga4231948c36c707fd5bc95e2e813ff7af">00963</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga4231948c36c707fd5bc95e2e813ff7af" title="Add configuration data for a complete SDO.">ecrt_slave_config_complete_sdo</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t index,
<a name="l00964"></a>00964         <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> size)
<a name="l00965"></a>00965 {
<a name="l00966"></a>00966     <a class="code" href="structec__slave.html" title="EtherCAT slave.">ec_slave_t</a> *slave = sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>;
<a name="l00967"></a>00967     <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *req;
<a name="l00968"></a>00968     <span class="keywordtype">int</span> ret;
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, index = 0x%04X, &quot;</span>
<a name="l00971"></a>00971             <span class="stringliteral">&quot;data = 0x%p, size = %zu)\n&quot;</span>, __func__, sc, index, data, size);
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="keywordflow">if</span> (slave &amp;&amp; !(slave-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#a7740732efd267741b956b8912502d8a1" title="Supported mailbox protocols.">mailbox_protocols</a> &amp; <a class="code" href="globals_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a228d7270dad743f55f7d42719e406076" title="CANopen over EtherCAT.">EC_MBOX_COE</a>)) {
<a name="l00974"></a>00974         <a class="code" href="slave__config_8h.html#a3115d8b69eddec5caf436c109fbf5b41" title="Convenience macro for printing configuration-specific warnings to syslog.">EC_CONFIG_WARN</a>(sc, <span class="stringliteral">&quot;Attached slave does not support CoE!\n&quot;</span>);
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="keywordflow">if</span> (!(req = (<a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *)
<a name="l00978"></a>00978           kmalloc(<span class="keyword">sizeof</span>(<a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a>), GFP_KERNEL))) {
<a name="l00979"></a>00979         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Failed to allocate memory for&quot;</span>
<a name="l00980"></a>00980                 <span class="stringliteral">&quot; SDO configuration!\n&quot;</span>);
<a name="l00981"></a>00981         <span class="keywordflow">return</span> -ENOMEM;
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     <a class="code" href="sdo__request_8c.html#a0e62e96b9d01ab1b89cc2df89d0ac8ef" title="SDO request constructor.">ec_sdo_request_init</a>(req);
<a name="l00985"></a>00985     <a class="code" href="group__ApplicationInterface.html#gae002eb267f69d91de0c83a5f4f349372" title="Set the SDO index and subindex.">ecrt_sdo_request_index</a>(req, index, 0);
<a name="l00986"></a>00986     req-&gt;<a class="code" href="structec__sdo__request.html#a98a6142382d920ac06195dd6b6de2990" title="SDO shall be transferred completely.">complete_access</a> = 1;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     ret = <a class="code" href="sdo__request_8c.html#af41428fb76fbb3a2bcf14a269a265476" title="Copies SDO data from an external source.">ec_sdo_request_copy_data</a>(req, data, size);
<a name="l00989"></a>00989     <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00990"></a>00990         <a class="code" href="sdo__request_8c.html#af3a555948ca6b916238e6c696d676645" title="SDO request destructor.">ec_sdo_request_clear</a>(req);
<a name="l00991"></a>00991         kfree(req);
<a name="l00992"></a>00992         <span class="keywordflow">return</span> ret;
<a name="l00993"></a>00993     }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00996"></a>00996     list_add_tail(&amp;req-&gt;<a class="code" href="structec__sdo__request.html#a80c68878d98d613513a0b985be43198e" title="List item.">list</a>, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#aa980b60539d3818999fe9ba116851e1c" title="List of SDO configurations.">sdo_configs</a>);
<a name="l00997"></a>00997     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l00998"></a>00998     <span class="keywordflow">return</span> 0;
<a name="l00999"></a>00999 }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001 <span class="comment">/*****************************************************************************/</span>
<a name="l01002"></a>01002 
<a name="l01003"></a><a class="code" href="group__ApplicationInterface.html#gae2540078423afe6763c5b7a2554f30bf">01003</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#gae2540078423afe6763c5b7a2554f30bf" title="Set the size of the CoE emergency ring buffer.">ecrt_slave_config_emerg_size</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, <span class="keywordtype">size_t</span> elements)
<a name="l01004"></a>01004 {
<a name="l01005"></a>01005     <span class="keywordflow">return</span> <a class="code" href="coe__emerg__ring_8c.html#af7cb32cfafb48b4dfeb112a6e18885af" title="Set the ring size.">ec_coe_emerg_ring_size</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a8a43523dca6d68508d858813f3d497a9" title="CoE emergency ring buffer.">emerg_ring</a>, elements);
<a name="l01006"></a>01006 }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008 <span class="comment">/*****************************************************************************/</span>
<a name="l01009"></a>01009 
<a name="l01010"></a><a class="code" href="group__ApplicationInterface.html#ga6b58a60d15afe8bab546a766653f227f">01010</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#ga6b58a60d15afe8bab546a766653f227f" title="Read and remove one record from the CoE emergency ring buffer.">ecrt_slave_config_emerg_pop</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint8_t *target)
<a name="l01011"></a>01011 {
<a name="l01012"></a>01012     <span class="keywordflow">return</span> <a class="code" href="coe__emerg__ring_8c.html#ab2da0f9ff8bdc6435eaa9ff40ec76f69" title="Remove an emergency message from the ring.">ec_coe_emerg_ring_pop</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a8a43523dca6d68508d858813f3d497a9" title="CoE emergency ring buffer.">emerg_ring</a>, target);
<a name="l01013"></a>01013 }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 <span class="comment">/*****************************************************************************/</span>
<a name="l01016"></a>01016 
<a name="l01017"></a><a class="code" href="group__ApplicationInterface.html#gad61c6ab7adf19f18953f34c8132c30a7">01017</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#gad61c6ab7adf19f18953f34c8132c30a7" title="Clears CoE emergency ring buffer and the overrun counter.">ecrt_slave_config_emerg_clear</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc)
<a name="l01018"></a>01018 {
<a name="l01019"></a>01019     <span class="keywordflow">return</span> <a class="code" href="coe__emerg__ring_8c.html#acd2793534be712998dee14e016eeef25" title="Clear the ring.">ec_coe_emerg_ring_clear_ring</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a8a43523dca6d68508d858813f3d497a9" title="CoE emergency ring buffer.">emerg_ring</a>);
<a name="l01020"></a>01020 }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022 <span class="comment">/*****************************************************************************/</span>
<a name="l01023"></a>01023 
<a name="l01024"></a><a class="code" href="group__ApplicationInterface.html#gad47666902ef543c1233a8fafcaa9e321">01024</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#gad47666902ef543c1233a8fafcaa9e321" title="Read the number of CoE emergency overruns.">ecrt_slave_config_emerg_overruns</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc)
<a name="l01025"></a>01025 {
<a name="l01026"></a>01026     <span class="keywordflow">return</span> <a class="code" href="coe__emerg__ring_8c.html#a6a2389648c819d72d008dc5e7749d359" title="Read the number of overruns.">ec_coe_emerg_ring_overruns</a>(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#a8a43523dca6d68508d858813f3d497a9" title="CoE emergency ring buffer.">emerg_ring</a>);
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 <span class="comment">/*****************************************************************************/</span>
<a name="l01030"></a>01030 
<a name="l01034"></a><a class="code" href="slave__config_8h.html#aeb245bf380388075266cde531b8f578e">01034</a> <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *<a class="code" href="slave__config_8c.html#a3c3525153d28cd7beef58fe017fbebb1" title="Same as ecrt_slave_config_create_sdo_request(), but with ERR_PTR() return value.">ecrt_slave_config_create_sdo_request_err</a>(
<a name="l01035"></a>01035         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t index, uint8_t subindex, <span class="keywordtype">size_t</span> size)
<a name="l01036"></a>01036 {
<a name="l01037"></a>01037     <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *req;
<a name="l01038"></a>01038     <span class="keywordtype">int</span> ret;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, &quot;</span>
<a name="l01041"></a>01041             <span class="stringliteral">&quot;index = 0x%04X, subindex = 0x%02X, size = %zu)\n&quot;</span>,
<a name="l01042"></a>01042             __func__, sc, index, subindex, size);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     <span class="keywordflow">if</span> (!(req = (<a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *)
<a name="l01045"></a>01045                 kmalloc(<span class="keyword">sizeof</span>(<a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a>), GFP_KERNEL))) {
<a name="l01046"></a>01046         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Failed to allocate SDO request memory!\n&quot;</span>);
<a name="l01047"></a>01047         <span class="keywordflow">return</span> ERR_PTR(-ENOMEM);
<a name="l01048"></a>01048     }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <a class="code" href="sdo__request_8c.html#a0e62e96b9d01ab1b89cc2df89d0ac8ef" title="SDO request constructor.">ec_sdo_request_init</a>(req);
<a name="l01051"></a>01051     <a class="code" href="group__ApplicationInterface.html#gae002eb267f69d91de0c83a5f4f349372" title="Set the SDO index and subindex.">ecrt_sdo_request_index</a>(req, index, subindex);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     ret = <a class="code" href="sdo__request_8c.html#a2f1e920bf54c7826a9747beae685caf4" title="Pre-allocates the data memory.">ec_sdo_request_alloc</a>(req, size);
<a name="l01054"></a>01054     <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l01055"></a>01055         <a class="code" href="sdo__request_8c.html#af3a555948ca6b916238e6c696d676645" title="SDO request destructor.">ec_sdo_request_clear</a>(req);
<a name="l01056"></a>01056         kfree(req);
<a name="l01057"></a>01057         <span class="keywordflow">return</span> ERR_PTR(ret);
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="comment">// prepare data for optional writing</span>
<a name="l01061"></a>01061     memset(req-&gt;<a class="code" href="structec__sdo__request.html#aa1f9c68c95c5fde23ed0807abf884b08" title="Pointer to SDO data.">data</a>, 0x00, size);
<a name="l01062"></a>01062     req-&gt;<a class="code" href="structec__sdo__request.html#a9a094314f738ed0fdf4b46f4bd37dfe9" title="Size of SDO data.">data_size</a> = size;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01065"></a>01065     list_add_tail(&amp;req-&gt;<a class="code" href="structec__sdo__request.html#a80c68878d98d613513a0b985be43198e" title="List item.">list</a>, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a51461cce3b38ac55be3e046c5e93a932" title="List of SDO requests.">sdo_requests</a>);
<a name="l01066"></a>01066     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     <span class="keywordflow">return</span> req;
<a name="l01069"></a>01069 }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071 <span class="comment">/*****************************************************************************/</span>
<a name="l01072"></a>01072 
<a name="l01073"></a><a class="code" href="group__ApplicationInterface.html#ga14aa167c0d4afd84b0fbada417a204f1">01073</a> <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *<a class="code" href="group__ApplicationInterface.html#ga14aa167c0d4afd84b0fbada417a204f1" title="Create an SDO request to exchange SDOs during realtime operation.">ecrt_slave_config_create_sdo_request</a>(
<a name="l01074"></a>01074         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint16_t index, uint8_t subindex, <span class="keywordtype">size_t</span> size)
<a name="l01075"></a>01075 {
<a name="l01076"></a>01076     <a class="code" href="structec__sdo__request.html" title="CANopen SDO request.">ec_sdo_request_t</a> *s = <a class="code" href="slave__config_8c.html#a3c3525153d28cd7beef58fe017fbebb1" title="Same as ecrt_slave_config_create_sdo_request(), but with ERR_PTR() return value.">ecrt_slave_config_create_sdo_request_err</a>(sc, index,
<a name="l01077"></a>01077             subindex, size);
<a name="l01078"></a>01078     <span class="keywordflow">return</span> IS_ERR(s) ? NULL : s;
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="comment">/*****************************************************************************/</span>
<a name="l01082"></a>01082 
<a name="l01086"></a><a class="code" href="slave__config_8h.html#afd699b4b268868a4a27a26aa6384ded6">01086</a> <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *<a class="code" href="slave__config_8c.html#a25c74750f388718c3e2a1caa374343d8" title="Same as ecrt_slave_config_create_reg_request(), but with ERR_PTR() return value.">ecrt_slave_config_create_reg_request_err</a>(
<a name="l01087"></a>01087         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, <span class="keywordtype">size_t</span> size)
<a name="l01088"></a>01088 {
<a name="l01089"></a>01089     <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *reg;
<a name="l01090"></a>01090     <span class="keywordtype">int</span> ret;
<a name="l01091"></a>01091 
<a name="l01092"></a>01092     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, size = %zu)\n&quot;</span>,
<a name="l01093"></a>01093             __func__, sc, size);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095     <span class="keywordflow">if</span> (!(reg = (<a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *)
<a name="l01096"></a>01096                 kmalloc(<span class="keyword">sizeof</span>(<a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a>), GFP_KERNEL))) {
<a name="l01097"></a>01097         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Failed to allocate register request memory!\n&quot;</span>);
<a name="l01098"></a>01098         <span class="keywordflow">return</span> ERR_PTR(-ENOMEM);
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     ret = <a class="code" href="reg__request_8c.html#abb50aa7b7886a25addbf52063faa4abc" title="Register request constructor.">ec_reg_request_init</a>(reg, size);
<a name="l01102"></a>01102     <span class="keywordflow">if</span> (ret) {
<a name="l01103"></a>01103         kfree(reg);
<a name="l01104"></a>01104         <span class="keywordflow">return</span> ERR_PTR(ret);
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01108"></a>01108     list_add_tail(&amp;reg-&gt;<a class="code" href="structec__reg__request.html#a5b7e2c24fe669f62e8d325a3537a1aec" title="List item.">list</a>, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a391b64268ec07ce78e7aa50c9641e436" title="List of register requests.">reg_requests</a>);
<a name="l01109"></a>01109     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01110"></a>01110 
<a name="l01111"></a>01111     <span class="keywordflow">return</span> reg;
<a name="l01112"></a>01112 }
<a name="l01113"></a>01113 
<a name="l01114"></a>01114 <span class="comment">/*****************************************************************************/</span>
<a name="l01115"></a>01115 
<a name="l01116"></a><a class="code" href="group__ApplicationInterface.html#ga1805e57c39e7bb12840c5e2589021dbe">01116</a> <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *<a class="code" href="group__ApplicationInterface.html#ga1805e57c39e7bb12840c5e2589021dbe" title="Create a register request to exchange EtherCAT register contents during realtime operation.">ecrt_slave_config_create_reg_request</a>(
<a name="l01117"></a>01117         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, <span class="keywordtype">size_t</span> size)
<a name="l01118"></a>01118 {
<a name="l01119"></a>01119     <a class="code" href="structec__reg__request.html" title="Register request.">ec_reg_request_t</a> *reg =
<a name="l01120"></a>01120         <a class="code" href="slave__config_8c.html#a25c74750f388718c3e2a1caa374343d8" title="Same as ecrt_slave_config_create_reg_request(), but with ERR_PTR() return value.">ecrt_slave_config_create_reg_request_err</a>(sc, size);
<a name="l01121"></a>01121     <span class="keywordflow">return</span> IS_ERR(reg) ? NULL : reg;
<a name="l01122"></a>01122 }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 <span class="comment">/*****************************************************************************/</span>
<a name="l01125"></a>01125 
<a name="l01129"></a><a class="code" href="slave__config_8h.html#ac689789b2a34a2e2c3c2acf401d41e56">01129</a> <a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *<a class="code" href="slave__config_8c.html#a842ef954d1e61932952886b2ea2a8deb" title="Same as ecrt_slave_config_create_voe_handler(), but with ERR_PTR() return value.">ecrt_slave_config_create_voe_handler_err</a>(
<a name="l01130"></a>01130         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, <span class="keywordtype">size_t</span> size)
<a name="l01131"></a>01131 {
<a name="l01132"></a>01132     <a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *voe;
<a name="l01133"></a>01133     <span class="keywordtype">int</span> ret;
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, size = %zu)\n&quot;</span>, __func__, sc, size);
<a name="l01136"></a>01136 
<a name="l01137"></a>01137     <span class="keywordflow">if</span> (!(voe = (<a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *)
<a name="l01138"></a>01138                 kmalloc(<span class="keyword">sizeof</span>(<a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a>), GFP_KERNEL))) {
<a name="l01139"></a>01139         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Failed to allocate VoE request memory!\n&quot;</span>);
<a name="l01140"></a>01140         <span class="keywordflow">return</span> ERR_PTR(-ENOMEM);
<a name="l01141"></a>01141     }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143     ret = <a class="code" href="voe__handler_8c.html#ac4f3ad1fe200fa0a1ea9c77d9a400f4d" title="VoE handler constructor.">ec_voe_handler_init</a>(voe, sc, size);
<a name="l01144"></a>01144     <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l01145"></a>01145         kfree(voe);
<a name="l01146"></a>01146         <span class="keywordflow">return</span> ERR_PTR(ret);
<a name="l01147"></a>01147     }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01150"></a>01150     list_add_tail(&amp;voe-&gt;<a class="code" href="structec__voe__handler.html#ab078e6fbc73c7bb4f7cb465b6c4abfa3" title="List item.">list</a>, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#afab81a75365c94fde03e15446fe7cc9e" title="List of VoE handlers.">voe_handlers</a>);
<a name="l01151"></a>01151     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     <span class="keywordflow">return</span> voe;
<a name="l01154"></a>01154 }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 <span class="comment">/*****************************************************************************/</span>
<a name="l01157"></a>01157 
<a name="l01158"></a><a class="code" href="group__ApplicationInterface.html#ga6341627f6bf764312dd6e8c3140e9be1">01158</a> <a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *<a class="code" href="group__ApplicationInterface.html#ga6341627f6bf764312dd6e8c3140e9be1" title="Create an VoE handler to exchange vendor-specific data during realtime operation.">ecrt_slave_config_create_voe_handler</a>(
<a name="l01159"></a>01159         <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, <span class="keywordtype">size_t</span> size)
<a name="l01160"></a>01160 {
<a name="l01161"></a>01161     <a class="code" href="structec__voe__handler.html" title="Vendor specific over EtherCAT handler.">ec_voe_handler_t</a> *voe = <a class="code" href="slave__config_8c.html#a842ef954d1e61932952886b2ea2a8deb" title="Same as ecrt_slave_config_create_voe_handler(), but with ERR_PTR() return value.">ecrt_slave_config_create_voe_handler_err</a>(sc,
<a name="l01162"></a>01162             size);
<a name="l01163"></a>01163     <span class="keywordflow">return</span> IS_ERR(voe) ? NULL : voe;
<a name="l01164"></a>01164 }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 <span class="comment">/*****************************************************************************/</span>
<a name="l01167"></a>01167 
<a name="l01168"></a><a class="code" href="group__ApplicationInterface.html#ga6b99c8912ed48a4ddce3d9470083dee1">01168</a> <span class="keywordtype">void</span> <a class="code" href="group__ApplicationInterface.html#ga6b99c8912ed48a4ddce3d9470083dee1" title="Outputs the state of the slave configuration.">ecrt_slave_config_state</a>(<span class="keyword">const</span> <a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc,
<a name="l01169"></a>01169         <a class="code" href="structec__slave__config__state__t.html" title="Slave configuration state.">ec_slave_config_state_t</a> *state)
<a name="l01170"></a>01170 {
<a name="l01171"></a>01171     state-&gt;<a class="code" href="structec__slave__config__state__t.html#a9e2af2cf43358d7abd1fdd04c293493f" title="The slave is online.">online</a> = sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a> ? 1 : 0;
<a name="l01172"></a>01172     <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structec__slave__config__state__t.html#a9e2af2cf43358d7abd1fdd04c293493f" title="The slave is online.">online</a>) {
<a name="l01173"></a>01173         state-&gt;<a class="code" href="structec__slave__config__state__t.html#aaadc9c8a1a5ee8b810ceaeed25723e61" title="The slave was brought into OP state using the specified configuration.">operational</a> =
<a name="l01174"></a>01174             sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#a6214f41ec1dce05b67b298b89a49e1f8" title="Current application state.">current_state</a> == <a class="code" href="globals_8h.html#a0e9c38c7520909d649fac451046dcde0a321dab0f12d522422d158b8cf64351f8" title="OP (mailbox communication and input/output update)">EC_SLAVE_STATE_OP</a>
<a name="l01175"></a>01175             &amp;&amp; !sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#a0baba2f1593708191871119e3570655f" title="Force (re-)configuration.">force_config</a>;
<a name="l01176"></a>01176         state-&gt;<a class="code" href="structec__slave__config__state__t.html#ae14213eb8fa0145ecf1250e46ff7c4af" title="The application-layer state of the slave.">al_state</a> = sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>-&gt;<a class="code" href="structec__slave.html#a6214f41ec1dce05b67b298b89a49e1f8" title="Current application state.">current_state</a>;
<a name="l01177"></a>01177     } <span class="keywordflow">else</span> {
<a name="l01178"></a>01178         state-&gt;<a class="code" href="structec__slave__config__state__t.html#aaadc9c8a1a5ee8b810ceaeed25723e61" title="The slave was brought into OP state using the specified configuration.">operational</a> = 0;
<a name="l01179"></a>01179         state-&gt;<a class="code" href="structec__slave__config__state__t.html#ae14213eb8fa0145ecf1250e46ff7c4af" title="The application-layer state of the slave.">al_state</a> = <a class="code" href="globals_8h.html#a0e9c38c7520909d649fac451046dcde0ae9edba07c48fe21c2e3ee549f98a0f59" title="unknown state">EC_SLAVE_STATE_UNKNOWN</a>;
<a name="l01180"></a>01180     }
<a name="l01181"></a>01181 }
<a name="l01182"></a>01182 
<a name="l01183"></a>01183 <span class="comment">/*****************************************************************************/</span>
<a name="l01184"></a>01184 
<a name="l01185"></a><a class="code" href="group__ApplicationInterface.html#gaa3d42e8188c64eaf794e8dc91a61b60b">01185</a> <span class="keywordtype">int</span> <a class="code" href="group__ApplicationInterface.html#gaa3d42e8188c64eaf794e8dc91a61b60b" title="Add an SoE IDN configuration.">ecrt_slave_config_idn</a>(<a class="code" href="structec__slave__config.html" title="EtherCAT slave configuration.">ec_slave_config_t</a> *sc, uint8_t drive_no,
<a name="l01186"></a>01186         uint16_t idn, <a class="code" href="group__ApplicationInterface.html#ga18c064146090e45d36c05876c546caea" title="Application-layer state.">ec_al_state_t</a> state, <span class="keyword">const</span> uint8_t *data,
<a name="l01187"></a>01187         <span class="keywordtype">size_t</span> size)
<a name="l01188"></a>01188 {
<a name="l01189"></a>01189     <a class="code" href="structec__slave.html" title="EtherCAT slave.">ec_slave_t</a> *slave = sc-&gt;<a class="code" href="structec__slave__config.html#ad1c2b1916ca2208c52cf0acbf6f1a8c7" title="Slave pointer.">slave</a>;
<a name="l01190"></a>01190     <a class="code" href="structec__soe__request__t.html" title="Sercos-over-EtherCAT request.">ec_soe_request_t</a> *req;
<a name="l01191"></a>01191     <span class="keywordtype">int</span> ret;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     <a class="code" href="slave__config_8h.html#a7aa9e6ccd549993399cfb813f6f81643" title="Convenience macro for printing configuration-specific debug messages to syslog.">EC_CONFIG_DBG</a>(sc, 1, <span class="stringliteral">&quot;%s(sc = 0x%p, drive_no = %u, idn = 0x%04X, &quot;</span>
<a name="l01194"></a>01194             <span class="stringliteral">&quot;state = %u, data = 0x%p, size = %zu)\n&quot;</span>,
<a name="l01195"></a>01195             __func__, sc, drive_no, idn, state, data, size);
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="keywordflow">if</span> (drive_no &gt; 7) {
<a name="l01198"></a>01198         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Invalid drive number %u!\n&quot;</span>,
<a name="l01199"></a>01199                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) drive_no);
<a name="l01200"></a>01200         <span class="keywordflow">return</span> -EINVAL;
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203     <span class="keywordflow">if</span> (state != <a class="code" href="group__ApplicationInterface.html#gga18c064146090e45d36c05876c546caeaaf31a3511a6004d7909a71911a289681f" title="Pre-operational.">EC_AL_STATE_PREOP</a> &amp;&amp; state != <a class="code" href="group__ApplicationInterface.html#gga18c064146090e45d36c05876c546caeaafb41d7398780a3f09ba2c19d624b2668" title="Safe-operational.">EC_AL_STATE_SAFEOP</a>) {
<a name="l01204"></a>01204         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;AL state for IDN config&quot;</span>
<a name="l01205"></a>01205                 <span class="stringliteral">&quot; must be PREOP or SAFEOP!\n&quot;</span>);
<a name="l01206"></a>01206         <span class="keywordflow">return</span> -EINVAL;
<a name="l01207"></a>01207     }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209     <span class="keywordflow">if</span> (slave &amp;&amp; !(slave-&gt;<a class="code" href="structec__slave.html#a081433f5a30f9352fbc4363093ae1e16" title="Extracted SII data.">sii</a>.<a class="code" href="structec__sii__t.html#a7740732efd267741b956b8912502d8a1" title="Supported mailbox protocols.">mailbox_protocols</a> &amp; <a class="code" href="globals_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab5ebd52d91b7f482bde14f6dcac7c7c4" title="Servo-Profile over EtherCAT.">EC_MBOX_SOE</a>)) {
<a name="l01210"></a>01210         <a class="code" href="slave__config_8h.html#a3115d8b69eddec5caf436c109fbf5b41" title="Convenience macro for printing configuration-specific warnings to syslog.">EC_CONFIG_WARN</a>(sc, <span class="stringliteral">&quot;Attached slave does not support SoE!\n&quot;</span>);
<a name="l01211"></a>01211     }
<a name="l01212"></a>01212 
<a name="l01213"></a>01213     <span class="keywordflow">if</span> (!(req = (<a class="code" href="structec__soe__request__t.html" title="Sercos-over-EtherCAT request.">ec_soe_request_t</a> *)
<a name="l01214"></a>01214           kmalloc(<span class="keyword">sizeof</span>(<a class="code" href="structec__soe__request__t.html" title="Sercos-over-EtherCAT request.">ec_soe_request_t</a>), GFP_KERNEL))) {
<a name="l01215"></a>01215         <a class="code" href="slave__config_8h.html#a295443b66bd44e07fe464ed83ead05fc" title="Convenience macro for printing configuration-specific errors to syslog.">EC_CONFIG_ERR</a>(sc, <span class="stringliteral">&quot;Failed to allocate memory for&quot;</span>
<a name="l01216"></a>01216                 <span class="stringliteral">&quot; IDN configuration!\n&quot;</span>);
<a name="l01217"></a>01217         <span class="keywordflow">return</span> -ENOMEM;
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220     <a class="code" href="soe__request_8c.html#ac48c2c807e1193b309dc20b08db88af1" title="SoE request constructor.">ec_soe_request_init</a>(req);
<a name="l01221"></a>01221     <a class="code" href="soe__request_8c.html#a33b01e254978df8b620d4dccc1d42569" title="Set drive number.">ec_soe_request_set_drive_no</a>(req, drive_no);
<a name="l01222"></a>01222     <a class="code" href="soe__request_8c.html#a1433bb1213a1ae25b9f9e5fdd9002668" title="Set IDN.">ec_soe_request_set_idn</a>(req, idn);
<a name="l01223"></a>01223     req-&gt;<a class="code" href="structec__soe__request__t.html#aa421217a4fc552dc2411b07010a4520a" title="AL state (only valid for IDN config).">al_state</a> = state;
<a name="l01224"></a>01224 
<a name="l01225"></a>01225     ret = <a class="code" href="soe__request_8c.html#a814c93a03b31ee5cc53ea6eec96a1bbc" title="Copies SoE data from an external source.">ec_soe_request_copy_data</a>(req, data, size);
<a name="l01226"></a>01226     <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l01227"></a>01227         <a class="code" href="soe__request_8c.html#af363b99bdce32c73c89bcec7520b5d01" title="SoE request destructor.">ec_soe_request_clear</a>(req);
<a name="l01228"></a>01228         kfree(req);
<a name="l01229"></a>01229         <span class="keywordflow">return</span> ret;
<a name="l01230"></a>01230     }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     down(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01233"></a>01233     list_add_tail(&amp;req-&gt;<a class="code" href="structec__soe__request__t.html#a07cafa8f400f95ced4f6037629c979f6" title="List item.">list</a>, &amp;sc-&gt;<a class="code" href="structec__slave__config.html#a9bfab1eba98284fcaa21079ea1700188" title="List of SoE configurations.">soe_configs</a>);
<a name="l01234"></a>01234     up(&amp;sc-&gt;<a class="code" href="structec__slave__config.html#ac5bef8d37047b658df7b56f7ebdbfecb" title="Master owning the slave configuration.">master</a>-&gt;<a class="code" href="structec__master.html#a322cd94f85808c07a046501df8308cc6" title="Master semaphore.">master_sem</a>);
<a name="l01235"></a>01235     <span class="keywordflow">return</span> 0;
<a name="l01236"></a>01236 }
<a name="l01237"></a>01237 
<a name="l01238"></a>01238 <span class="comment">/*****************************************************************************/</span>
<a name="l01239"></a>01239 
<a name="l01242"></a>01242 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga4ac6eae111bdbf1d4cd09fa2f965a887" title="Configure a sync manager.">ecrt_slave_config_sync_manager</a>);
<a name="l01243"></a>01243 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gaba67c3e575110297f9fdcffad573d367" title="Configure a slave&#39;s watchdog times.">ecrt_slave_config_watchdog</a>);
<a name="l01244"></a>01244 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gaef2958fe19c088978857e7b91f692630" title="Add a PDO to a sync manager&#39;s PDO assignment.">ecrt_slave_config_pdo_assign_add</a>);
<a name="l01245"></a>01245 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gafc2fb2a662bd8129dea5330e5e313b5f" title="Clear a sync manager&#39;s PDO assignment.">ecrt_slave_config_pdo_assign_clear</a>);
<a name="l01246"></a>01246 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga3a0f83e1c3e3edf978b3017f94cc375d" title="Add a PDO entry to the given PDO&#39;s mapping.">ecrt_slave_config_pdo_mapping_add</a>);
<a name="l01247"></a>01247 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga8496abee3bd32fec5ffd74bf4705cc53" title="Clear the mapping of a given PDO.">ecrt_slave_config_pdo_mapping_clear</a>);
<a name="l01248"></a>01248 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga7bc2683699a5c0c551f0cfdc90c1a559" title="Specify a complete PDO configuration.">ecrt_slave_config_pdos</a>);
<a name="l01249"></a>01249 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga44fe6bd549328c34ca4ed6893765206f" title="Registers a PDO entry for process data exchange in a domain.">ecrt_slave_config_reg_pdo_entry</a>);
<a name="l01250"></a>01250 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga05858fdb5052dfb1161a81d2f8beb553" title="Configure distributed clocks.">ecrt_slave_config_dc</a>);
<a name="l01251"></a>01251 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gacf5b3147d6fa082ed73417cf7aa4e240" title="Add an SDO configuration.">ecrt_slave_config_sdo</a>);
<a name="l01252"></a>01252 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga93e038f9065d20ea3fa5738c495f0ae5" title="Add a configuration value for an 8-bit SDO.">ecrt_slave_config_sdo8</a>);
<a name="l01253"></a>01253 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gaacb7fefc226e3a3c0225c39d233d2fa8" title="Add a configuration value for a 16-bit SDO.">ecrt_slave_config_sdo16</a>);
<a name="l01254"></a>01254 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga0a87e59a5448389907652ddb2f5768fd" title="Add a configuration value for a 32-bit SDO.">ecrt_slave_config_sdo32</a>);
<a name="l01255"></a>01255 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga4231948c36c707fd5bc95e2e813ff7af" title="Add configuration data for a complete SDO.">ecrt_slave_config_complete_sdo</a>);
<a name="l01256"></a>01256 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gae2540078423afe6763c5b7a2554f30bf" title="Set the size of the CoE emergency ring buffer.">ecrt_slave_config_emerg_size</a>);
<a name="l01257"></a>01257 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga6b58a60d15afe8bab546a766653f227f" title="Read and remove one record from the CoE emergency ring buffer.">ecrt_slave_config_emerg_pop</a>);
<a name="l01258"></a>01258 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gad61c6ab7adf19f18953f34c8132c30a7" title="Clears CoE emergency ring buffer and the overrun counter.">ecrt_slave_config_emerg_clear</a>);
<a name="l01259"></a>01259 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gad47666902ef543c1233a8fafcaa9e321" title="Read the number of CoE emergency overruns.">ecrt_slave_config_emerg_overruns</a>);
<a name="l01260"></a>01260 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga14aa167c0d4afd84b0fbada417a204f1" title="Create an SDO request to exchange SDOs during realtime operation.">ecrt_slave_config_create_sdo_request</a>);
<a name="l01261"></a>01261 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga6341627f6bf764312dd6e8c3140e9be1" title="Create an VoE handler to exchange vendor-specific data during realtime operation.">ecrt_slave_config_create_voe_handler</a>);
<a name="l01262"></a>01262 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga1805e57c39e7bb12840c5e2589021dbe" title="Create a register request to exchange EtherCAT register contents during realtime operation.">ecrt_slave_config_create_reg_request</a>);
<a name="l01263"></a>01263 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#ga6b99c8912ed48a4ddce3d9470083dee1" title="Outputs the state of the slave configuration.">ecrt_slave_config_state</a>);
<a name="l01264"></a>01264 EXPORT_SYMBOL(<a class="code" href="group__ApplicationInterface.html#gaa3d42e8188c64eaf794e8dc91a61b60b" title="Add an SoE IDN configuration.">ecrt_slave_config_idn</a>);
<a name="l01265"></a>01265 
<a name="l01268"></a>01268 <span class="comment">/*****************************************************************************/</span>
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="slave__config_8c.html">slave_config.c</a>      </li>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
